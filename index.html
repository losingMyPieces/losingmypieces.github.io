<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="zero">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="zero">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zyming">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>zero</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">zero</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zyming</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/losingMyPieces" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;losingMyPieces" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zyming21@gmail.com" title="E-Mail → mailto:zyming21@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    

<!-- require APlayer -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<meting-js
	server="netease"
	type="playlist"
	id="12755984864">
</meting-js>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/30/essay-chefDing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/30/essay-chefDing/" class="post-title-link" itemprop="url">庄子·内篇·养生主（庖丁解牛）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-30 15:57:15 / 修改时间：16:01:30" itemprop="dateCreated datePublished" datetime="2024-12-30T15:57:15+08:00">2024-12-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="原文与理解"><a href="#原文与理解" class="headerlink" title="原文与理解"></a>原文与理解</h1><blockquote>
<p><u>吾生也有涯，而知也无涯。以有涯随无涯，殆已！已而为知者，殆而已矣！为善无近名，为恶无近刑。缘督以为经，可以保身，可以全生，可以养亲，可以尽年。</u></p>
</blockquote>
<p>人的生命有限，而知识却无限。以有限生命去追求无限知识，势必体乏神伤！既然如此还在不停地追求知识，已经非常危险了！做好事不要为了追求名声，做坏事不要等到受到惩罚。遵循自然的规律，可以保全自己的身体，可以维护生命的安全，可以奉养父母，可以享尽天年。</p>
<blockquote>
<p>庖(páo)丁为文惠君解牛，手之所触，肩之所倚，足之所履，膝之所踦(yǐ)，砉(xū)然向(xiǎng)然，奏刀騞(huō)然，莫不中(zhòng)音。合于《桑林》之舞，乃中《经首》之会。<sup>(丁师傅为梁惠王杀牛，从筋骨之空隙游刃有余)</sup></p>
<p>文惠君曰：“嘻，善哉！技盖(hé)至此乎？”</p>
<p>庖丁释刀对曰：“<span data-type="text" style="color: var(--b3-font-color13);">臣之所好者，道也，进乎技矣</span>。</p>
</blockquote>
<p>我所追求的是道，已经超过一般的技术了。</p>
<blockquote>
<p>始臣之解牛之时，所见无非牛者。三年之后，未尝见全牛也。方今之时，臣以神遇而不以目视，官知止而神欲行。依乎天理，批大郤(xì)，导大窾(kuǎn)，因其固然，技经肯綮(qìng)之未尝，而况大軱(gū)乎！良庖岁更刀，割也；族庖月更刀，折也。今臣之刀十九年矣，所解数千牛矣，而刀刃若新发于硎(xíng)。彼节者有间(jiàn)，而刀刃者无厚；以无厚入有间，恢恢乎其于游刃必有余地矣，是以十九年而刀刃若新发于硎。虽然，每至于族，吾见其难为，怵(chù)然为戒，视为止，行为迟。动刀甚微，謋(huò)然已解，如土委地。提刀而立，为之四顾，为之踌(chóu)躇(chú)满志，善刀而藏之。”<sup>(这段文字通过庖丁解牛的过程，形象地描绘了如何通过长期的实践和对事物本质的理解，达到一种超越技术的境界。庖丁不仅仅是在解牛，而是在遵循自然规律，顺应事物的本质，从而实现了效率与艺术的完美结合。庄子借此表达了“道”的重要性，强调人们应当在日常生活中追求与自然和谐相处的智慧。)</sup></p>
<p>文惠君曰：“善哉！吾闻庖丁之言，得养生焉。”</p>
</blockquote>
<h1 id="道理"><a href="#道理" class="headerlink" title="道理"></a>道理</h1><ol>
<li><span data-type="text" style="background-color: var(--b3-font-background13); color: var(--b3-font-color10);">做事应处处小心，还要保持着一种谨慎小心的态度，收敛锋芒，并且在懂得利用规律的同时，更要去反复实践，像庖丁“所解数千牛矣”一样，不停地重复，终究会悟出事物的真理所在。</span></li>
<li><span data-type="text" style="color: var(--b3-font-color10); background-color: var(--b3-font-background13);">人类社会充满着错综复杂的矛盾，人处世间，只有像庖丁解牛那样避开矛盾，做到顺应自然，才能保身、全生、养心、尽年。</span></li>
<li><span data-type="text" style="background-color: var(--b3-font-background13); color: var(--b3-font-color10);">牛无疑是很复杂的，庖丁解牛，为什么能一刀下去，刀刀到位，轻松简单，原因是什么？是因为掌握了它的肌理。牛与牛当然各不相同，但不管是什么牛，它们的肌理都是一致的；每个人的生活也各有各的面貌，其基本原理也是近似的。庖丁因为熟悉了牛的肌理，自然懂得何处下刀。生活也一样，如果能透解了、领悟了生活的道理，摸准了其中的规律，就能和庖丁一样，做到目中有牛又无牛，就能化繁为简，真正获得轻松。</span></li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>几天前看了雷军对武大学生的一次演讲，他说<strong>不是我们真的要把每个考试都考到100分，一定考到全年级第一才叫成功，</strong> 上大学最重要的是获得学习能力。我深感认同，因为我曾经去追求将一个考试科目学到极致，但换来的结果甚至不如同学临近期末的高强度复习。在大学里，掌握考试不挂科和拿高分的方法也是一种学习能力，但不应为此花费太多的精力，如果谁这样做了，那一定违背了客观的规律。</p>
<p>世界上的知识浩如烟海，而人生短短数十载，以有涯随无涯，殆矣！人的一生都在学习知识，有些知识是重要的，而有些知识却是无用，或者说是暂时没有派上用场，比如一个10岁不到的小孩是用不上驾驶汽车的知识的，因此要做的仅仅是知道它的存在。一些我们不可避免要学习的知识其实也是如此，比如考试或某些硬性要求。</p>
<p>普通的厨师杀牛一个月换一次刀，优秀的厨师杀牛一年换一次刀，而庖丁的刀用了19年不换，侧面说明做人的境界并不是越锋锐，越刚硬越好，而是应该做到避免矛盾的发生，遵循客观规律，切中肯綮。</p>
<p>从实践中总结规律，技精近乎道。反复实践并不意味着重复与枯燥，而是让每一次的实践更接近道。</p>
<h1 id="相关成语"><a href="#相关成语" class="headerlink" title="相关成语"></a>相关成语</h1><ol>
<li><strong>游刃有余</strong>：比喻技术熟练高超，做事轻而易举。</li>
<li><strong>目无全牛</strong>：指技艺达到极其纯熟的程度，达到得心应手的境界。</li>
<li><strong>切中肯綮</strong>：比喻正好击中关键部位。</li>
<li><strong>庖丁解牛</strong>：比喻掌握了解事物客观规律的人；技术纯熟神妙；做事得心应手。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.gushiwen.cn/guwen/bookv.aspx?id=46653FD803893E4FE9AF0CF62B7DA105">庄子·内篇·养生主_古诗文网</a></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9B">庖丁解牛 - 维基百科，自由的百科全书</a></p>
<p><a target="_blank" rel="noopener" href="https://m.gushici.net/shici/07/62076.html">庖丁解牛原文、翻译及赏析_庄周_古诗词网</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/11/Linux-shell-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/11/Linux-shell-2/" class="post-title-link" itemprop="url">Shell流程控制</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-11 13:46:12 / 修改时间：13:53:52" itemprop="dateCreated datePublished" datetime="2024-12-11T13:46:12+08:00">2024-12-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="if条件判断语句"><a href="#if条件判断语句" class="headerlink" title="if条件判断语句"></a>if条件判断语句</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 表达式 ; <span class="keyword">then</span></span><br><span class="line">	语句1</span><br><span class="line"><span class="keyword">elif</span> 表达式 ; <span class="keyword">then</span> <span class="comment"># 可以不要</span></span><br><span class="line">	语句2</span><br><span class="line"><span class="keyword">else</span> <span class="comment"># 可以不要</span></span><br><span class="line">	语句3</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>表达式可以用到的逻辑运算符：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>判断文件是否存在eg: if [ -f filename ]</td>
</tr>
<tr>
<td>-d</td>
<td>判断目录是否存在eg: if [ -d dir ]</td>
</tr>
<tr>
<td>-eq</td>
<td>等于 应用于：整型比较</td>
</tr>
<tr>
<td>-ne</td>
<td>不等于 应用于：整型比较</td>
</tr>
<tr>
<td>-lt</td>
<td>小于 应用于：整型比较</td>
</tr>
<tr>
<td>-gt</td>
<td>大于 应用于：整型比较</td>
</tr>
<tr>
<td>-le</td>
<td>小于或等于 应用于：整型比较</td>
</tr>
<tr>
<td>-ge</td>
<td>大于或等于 应用于：整型比较</td>
</tr>
<tr>
<td>-a</td>
<td>and。 eg: [ 表达式 -a 表达式 ]</td>
</tr>
<tr>
<td>-o</td>
<td>or。eg: [ 表达式 -o 表达式 ]</td>
</tr>
<tr>
<td>-z</td>
<td>空字符串</td>
</tr>
</tbody></table>
<p>如果使用 ((…)) 作为判断语句，大于和小于可以直接使用 &gt; 和 &lt;。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"><span class="keyword">if</span> (( <span class="variable">$a</span> == <span class="variable">$b</span> ))</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">elif</span> (( <span class="variable">$a</span> &gt; <span class="variable">$b</span> ))</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 大于 b&quot;</span></span><br><span class="line"><span class="keyword">elif</span> (( <span class="variable">$a</span> &lt; <span class="variable">$b</span> ))</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 小于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;没有符合的条件&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>if else 语句经常与 test 命令结合使用，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num1=$[2*3]</span><br><span class="line">num2=$[1+5]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> $[num1] -eq $[num2]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;两个数字相等!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;两个数字不相等!&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h1 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h1><p>与其他编程语言类似，Shell支持for循环。这里直接给出例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> loop <span class="keyword">in</span> 1 2 3 4 5</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The value is: <span class="variable">$loop</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="while-语句"><a href="#while-语句" class="headerlink" title="while 语句"></a>while 语句</h1><p>直接给出例子：以下是一个基本的 while 循环，测试条件是：如果 i 小于等于 5，那么条件返回真。i 从 1 开始，每次循环处理时，i 加 1。运行上述脚本，返回数字 1 到 5，然后终止。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span>(( <span class="variable">$i</span>&lt;=<span class="number">5</span> ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">    <span class="built_in">let</span> i++</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>以上实例使用了 Bash let 命令，它用于执行一个或多个表达式，变量计算中不需要加上 $ 来表示变量，具体可查阅：<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-let.html">Bash let 命令</a>。while循环可用于读取键盘信息。下面的例子中，给出了一个持续交互的while循环。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;-----------------------&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;按下 &lt;CTRL-D&gt; 退出&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&#x27;输入你最喜欢的网站名: &#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> FILM</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;是的！<span class="variable">$FILM</span> 是一个好网站&quot;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;-----------------------&#x27;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;按下 &lt;CTRL-D&gt; 退出&#x27;</span></span><br><span class="line">	<span class="built_in">echo</span> -n <span class="string">&#x27;接着输入你最喜欢的网站名: &#x27;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="无限循环"><a href="#无限循环" class="headerlink" title="无限循环"></a>无限循环</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	COMMAND</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>Shell的循环同样可以用关键词<strong>break</strong>和<strong>continue</strong>跳出，<strong>continue</strong>跳出当前循环，而<strong>break</strong>跳出所有循环。</p>
<h1 id="until-循环"><a href="#until-循环" class="headerlink" title="until 循环"></a>until 循环</h1><p>until 循环与 while 循环在处理方式上刚好相反，until 循环执行一系列命令直至条件为 true 时停止。一般 while 循环优于 until 循环，但在某些时候也只是极少数情况下，until 循环更加有用。condition 一般为条件表达式，如果返回值为 false，则继续执行循环体内的语句，否则跳出循环。以下实例我们使用 until 命令来输出 0 ~ 9 的数字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=0</span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> [ ! <span class="variable">$a</span> -lt 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">   a=`<span class="built_in">expr</span> <span class="variable">$a</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h1><p>case为多选择语句，与其他语言中的 switch … case 语句类似，是一种多分支选择结构，每个 case 分支用右圆括号开始，用两个分号  <strong>;;</strong>  表示 break，即执行结束，跳出整个 case … esac 语句，esac（就是 case 反过来）作为结束标记。</p>
<p>case 取值后面必须为单词 <strong>in</strong>，每一模式必须以右括号结束。取值可以为变量或常数，匹配发现取值符合某一模式后，其间所有命令开始执行直至  <strong>;;</strong> 。取值将检测匹配的每一个模式。一旦模式匹配，则执行完匹配模式相应命令后不再继续其他模式。如果无一匹配模式，使用**星号 ***  捕获该值，再执行后面的命令。下面的脚本提示输入 1 到 4，与每一种模式进行匹配：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;输入 1 到 4 之间的数字:&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;你输入的数字为:&#x27;</span></span><br><span class="line"><span class="built_in">read</span> aNum</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$aNum</span> <span class="keyword">in</span></span><br><span class="line">    1)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 1&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    2)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 2&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    3)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 3&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    4)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 4&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    *)  <span class="built_in">echo</span> <span class="string">&#x27;你没有输入 1 到 4 之间的数字&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/09/Linux-shell-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/09/Linux-shell-1/" class="post-title-link" itemprop="url">Shell变量、运算符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-09 13:24:03 / 修改时间：13:25:31" itemprop="dateCreated datePublished" datetime="2024-12-09T13:24:03+08:00">2024-12-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Shell 是操作系统的最外层，为用户提供了一个与系统交互的界面，它不仅支持直接输入命令来控制进程和文件，还整合了编程语言的特性，使用户能够通过编写脚本实现复杂的任务。可以说，Shell 是用户与 Linux 操作系统之间的重要桥梁。</p>
<p>Linux 系统中的 Shell 种类非常丰富，常见的有 <strong>Bourne Shell</strong>（<code>/usr/bin/sh</code>​）、<strong>Bourne Again Shell</strong>（<code>/usr/bin/bash</code>​）、<strong>C Shell</strong>、<strong>Korn Shell</strong>（K Shell）等。由于不同的 Shell 拥有不同的语法特性，它们之间的脚本通常不能直接通用。然而，在众多选择中，最为流行且广泛使用的便是 <strong>Bash</strong>（Bourne Again Shell），它功能强大、兼容性好，几乎是所有现代 Linux 发行版的默认 Shell，后面shell默认为Bash。</p>
<p>接下来探讨 Shell 脚本的基本语法与核心功能，并通过实际案例展示如何利用 Bash 脚本高效地完成任务。在运维过程中，常涉及到查询登录文档、追踪流量、监控主机硬件状态、用户使用情况以及主机软件更新查询等操作。为了避免每次手动处理这些繁琐任务，编写 <strong>固定的自动化处理流程</strong> —— 即 Shell 脚本，成为了必要的解决方案。Shell 脚本是利用 Shell 的功能编写的程序，它是一个 <strong>纯文本文件</strong>，包含了 Shell 的语法和指令，并结合 <strong>正规文法</strong>、<strong>管道命令</strong>和 <strong>数据流重定向</strong> 等功能，能够自动化执行多种系统管理任务，从而提高工作效率并减少人工操作的错误。</p>
<p>shell脚本一般文件名以.sh结尾，文件的第一行定义出该脚本的类型。其基本格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                           </span></span><br><span class="line"><span class="comment"># scripte:  test.sh                  </span></span><br><span class="line"><span class="comment"># author:   zyming                   </span></span><br><span class="line"><span class="comment"># date:     2024-12-4                </span></span><br><span class="line"><span class="comment"># funtion:  echo the scripts arguments </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;脚本名： <span class="variable">$0</span>&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;已接收参数数量： <span class="variable">$#</span>&quot;</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有参数： $*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;返回状态:  $?&quot;</span> </span><br></pre></td></tr></table></figure>

<p>如上述脚本的注释记录了必要的信息，例如脚本功能，编写时间等，功能为输出shell脚本的传递参数。</p>
<p>如何去执行脚本呢？在执行之前首先要赋予执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> uo+x test.sh</span><br></pre></td></tr></table></figure>

<p>其次可以直接运行或者sh运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./test.sh 或者/usr/bin/sh test.sh</span><br><span class="line"></span><br><span class="line">[zyming@localhost ~]$ /usr/bin/sh test.sh 1 2 3</span><br><span class="line">脚本名： test.sh</span><br><span class="line">已接收参数数量： 3</span><br><span class="line">所有参数： 1 2 3</span><br><span class="line">返回状态:  0</span><br></pre></td></tr></table></figure>

<p>返回状态0表示正常执行结束退出。</p>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>Shell是非类型的编程语言，不像c++&#x2F;java编程要声明变量，shell给一个变量赋值，实际上就是定义了变量。定义变量时，变量不加$，而使用的时候需要，标准引用变量格式。</p>
<p>Shell变量可以分为2类：</p>
<ol>
<li>局部变量只在创建它们的shell脚本中使用；</li>
<li>环境变量可以在创建它们的shell以及派生出的任意子进程中使用。</li>
</ol>
<p>变量名的命名遵循以下规则：</p>
<ol>
<li><strong>只含数字、字母和下划线</strong></li>
<li><strong>不能以数字开头</strong></li>
<li><strong>避免使用Shell关键字</strong>：例如，for， if，then…</li>
<li><strong>常量使用大写字母</strong>：例如，PI&#x3D;3.14…</li>
<li><strong>避免使用空格</strong></li>
</ol>
<p>有效的变量名如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LD_LIBRARY_PATH=<span class="string">&quot;/bin/&quot;</span></span><br><span class="line">_var=<span class="string">&quot;123&quot;</span></span><br><span class="line">var2=<span class="string">&quot;abc&quot;</span></span><br></pre></td></tr></table></figure>

<p>无效的变量名如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#避免使用if作为变量名</span></span><br><span class="line"><span class="keyword">if</span>=<span class="string">&quot;some_value&quot;</span></span><br><span class="line"><span class="comment">#避免使用 $ 等特殊符号</span></span><br><span class="line">variable_with_$=42</span><br><span class="line">?var=123</span><br><span class="line">user*name=runoob</span><br><span class="line"><span class="comment">#避免空格</span></span><br><span class="line">variable with space=<span class="string">&quot;value&quot;</span></span><br></pre></td></tr></table></figure>

<p>除了显示地直接赋值，还可以用语句给变量赋值，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `<span class="built_in">ls</span> /etc`</span><br><span class="line">或</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(<span class="built_in">ls</span> /etc)</span><br></pre></td></tr></table></figure>

<p>以上语句将&#x2F;etc下的文件名循环赋值给file。</p>
<h2 id="只读变量"><a href="#只读变量" class="headerlink" title="只读变量"></a>只读变量</h2><p>使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变。</p>
<p>下面的例子尝试更改只读变量，结果报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">myUrl=<span class="string">&quot;https://www.google.com&quot;</span></span><br><span class="line"><span class="built_in">readonly</span> myUrl</span><br><span class="line">myUrl=<span class="string">&quot;https://www.runoob.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果如下：</span></span><br><span class="line">/bin/sh: NAME: This variable is <span class="built_in">read</span> only.</span><br></pre></td></tr></table></figure>

<h2 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h2><p>使用 unset 命令可以删除变量。用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> variable_name</span><br></pre></td></tr></table></figure>

<p>变量被删除后不能再次使用。unset 命令不能删除只读变量。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="字符串变量"><a href="#字符串变量" class="headerlink" title="字符串变量"></a>字符串变量</h3><p>在 Shell中，变量通常被视为字符串。你可以使用单引号 ‘ 或双引号 “ 来定义字符串，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_string=<span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line">或者</span><br><span class="line">my_string=<span class="string">&quot;Hello, World!&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中，单引号’里的内容会原样输出，而双引号“的内容里存在变量或者表达式则会被解析为其具体的数值。</p>
<h3 id="整数变量"><a href="#整数变量" class="headerlink" title="整数变量"></a><strong>整数变量</strong></h3><p>使用 <strong>declare</strong> 或 <strong>typeset</strong> 命令来声明整数变量。这样的变量只包含整数值，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -i my_integer=42</span><br></pre></td></tr></table></figure>

<p>这样的声明告诉 Shell 将 my_integer 视为整数，如果尝试将非整数值赋给它，Shell会尝试将其转换为整数。</p>
<h3 id="数组变量"><a href="#数组变量" class="headerlink" title="数组变量"></a><strong>数组变量</strong></h3><p>Shell 也支持数组，允许你在一个变量中存储多个值。数组可以是整数索引数组或关联数组，以下是一个简单的整数索引数组的例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">my_array=(1 2 3 4 5)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出数组</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;my_array[*]&#125;</span> <span class="comment"># &#123;&#125;是必须的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出数组元素</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;my_array[n]&#125;</span> <span class="comment"># n这里可以是0~4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#循环处理数组</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!my_array[*]&#125;</span> <span class="comment"># 加!表示i从0开始</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span> -&gt; <span class="variable">$&#123;my_array[$i]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出数组长度</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#my_array[*]&#125;</span></span><br></pre></td></tr></table></figure>

<p>或者关联数组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A associative_array</span><br><span class="line">associative_array[<span class="string">&quot;name&quot;</span>]=<span class="string">&quot;John&quot;</span></span><br><span class="line">associative_array[<span class="string">&quot;age&quot;</span>]=30</span><br></pre></td></tr></table></figure>

<p>经测试，关联数组的输出方法与整数索引数组基本一致，不同之处在于，一个通过索引来访问数组，一个通过键来访问数组。</p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>这些是由操作系统或用户设置的特殊变量，用于配置 Shell 的行为和影响其执行环境。例如，<strong>PATH</strong> 变量包含了操作系统搜索可执行文件的路径，<strong>HISTSIZE</strong>变量设置了可记录的历史指令的条数。但需注意，Linux操作系统有不止一个环境，他们是总环境&#x2F;etc&#x2F;profile和用户环境&#x2F;home&#x2F;[user]&#x2F;.bash_profile，<strong>通常</strong>如果相同的环境变量有不一致的地方<strong>以用户自己的环境变量为准</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#临时添加环境变量PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/new/path <span class="comment"># 增加到变量已存放数值的末尾</span></span><br><span class="line">或者</span><br><span class="line"><span class="built_in">export</span> PATH=/new/path:<span class="variable">$PATH</span> <span class="comment"># 增加到变量已存放数值的开头</span></span><br></pre></td></tr></table></figure>

<p>为了让路径的修改在每次登录后都生效，可以将 <code>export PATH=...</code>​ 这条命令添加到你的用户配置文件中（如 <code>.bashrc</code>​ 或 <code>.bash_profile</code>​，具体取决于你的系统配置）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 使改动生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>

<h2 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h2><p>我们可以在执行 Shell 脚本时，向脚本传递参数，脚本内获取参数的格式为 $n，<strong>n</strong> 代表一个数字，<strong>1</strong> 为执行脚本的第一个参数，<strong>2</strong> 为执行脚本的第二个参数。</p>
<p>例如可以使用 $1、$2 等来引用传递给脚本的参数，其中 $1 表示第一个参数，$2 表示第二个参数，依此类推。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>$0</td>
<td>当前程序名称</td>
</tr>
<tr>
<td>$n</td>
<td>第n个参数</td>
</tr>
<tr>
<td>$$</td>
<td>脚本运行的当前进程ID号</td>
</tr>
<tr>
<td>$!</td>
<td>后台运行的最后一个进程的ID号</td>
</tr>
<tr>
<td>$*</td>
<td>以一个单字符串显示所有向脚本传递的参数。当前程序的所有参数（不包括程序本身）</td>
</tr>
<tr>
<td>$@</td>
<td>以”$1” “$2” … “$n” 的形式输出所有参数。用于循环。</td>
</tr>
<tr>
<td>$#</td>
<td>参数个数（不包括程序本身）</td>
</tr>
<tr>
<td>$?</td>
<td>程序返回值</td>
</tr>
<tr>
<td>$-</td>
<td>显示Shell使用的当前选项，与<a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-set.html">set命令</a>功能相同。</td>
</tr>
<tr>
<td>$UID</td>
<td>用户ID</td>
</tr>
<tr>
<td>$PWD</td>
<td>当前目录</td>
</tr>
</tbody></table>
<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>Shell 和其他编程语言一样，支持多种运算符，包括：</p>
<ul>
<li>算数运算符</li>
<li>关系运算符</li>
<li>布尔运算符</li>
<li>字符串运算符</li>
<li>文件测试运算符</li>
</ul>
<p>原生bash不支持简单的数学运算，但是可以通过其他命令来实现，例如 awk 和 expr，expr 最常用。expr 是一款表达式计算工具，使用它能完成表达式的求值操作。例如，两个数相加(<strong>注意使用的是反引号</strong>  <strong>&#96;</strong>  <strong>而不是单引号 ‘</strong> )：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val=`<span class="built_in">expr</span> = 2 + 2`</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>表达式和运算符之间要有空格，例如 2+2 是不对的，必须写成 2 + 2，这与我们熟悉的大多数编程语言不一样。</li>
<li>完整的表达式要被 ` ` 包含，注意这个字符不是常用的单引号，在 Esc 键下边。</li>
</ul>
<h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><p>下表列出了常用的算术运算符，假定变量 a 为 10，变量 b 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法</td>
<td>`expr $a + $b` 结果为 30。</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
<td>`expr $a - $b` 结果为 -10。</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
<td>`expr $a \* $b` 结果为  200。</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>除法</td>
<td>`expr $b &#x2F; $a` 结果为 2。</td>
</tr>
<tr>
<td>%</td>
<td>取余</td>
<td>`expr $b % $a` 结果为 0。</td>
</tr>
<tr>
<td>=</td>
<td>赋值</td>
<td>a=$b 把变量 b 的值赋给 a。</td>
</tr>
<tr>
<td>==</td>
<td>相等。</td>
<td>[ $a == $b ] 返回 false。</td>
</tr>
<tr>
<td>!=</td>
<td>不相等。</td>
<td>[ $a != $b ] 返回 true。</td>
</tr>
</tbody></table>
<p><strong>注意：</strong> 条件表达式要放在方括号之间，并且要有空格，例如:  <strong>[$a&#x3D;&#x3D;$b]</strong>  是错误的，必须写成  <strong>[</strong>   <strong>$a</strong>  <strong>&#x3D;&#x3D;</strong>    <strong>$b ]</strong> 。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                           </span></span><br><span class="line"><span class="comment"># scripte:  arith.sh                  </span></span><br><span class="line"><span class="comment"># author:   zyming                   </span></span><br><span class="line"><span class="comment"># date:     2024-12-9                </span></span><br><span class="line"><span class="comment"># funtion:  display Arithmetic operations </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line">val=`<span class="built_in">expr</span> <span class="variable">$a</span> + <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a + b : <span class="variable">$val</span>&quot;</span></span><br><span class="line"></span><br><span class="line">val=`<span class="built_in">expr</span> <span class="variable">$a</span> - <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a - b : <span class="variable">$val</span>&quot;</span></span><br><span class="line"></span><br><span class="line">val=`<span class="built_in">expr</span> <span class="variable">$a</span> \* <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a * b : <span class="variable">$val</span>&quot;</span></span><br><span class="line"></span><br><span class="line">val=`<span class="built_in">expr</span> <span class="variable">$b</span> / <span class="variable">$a</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;b / a : <span class="variable">$val</span>&quot;</span></span><br><span class="line"></span><br><span class="line">val=`<span class="built_in">expr</span> <span class="variable">$b</span> % <span class="variable">$a</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;b % a : <span class="variable">$val</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> == <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 不等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行结果</span></span><br><span class="line">: <span class="string">&#x27; </span></span><br><span class="line"><span class="string">[zyming@localhost ~]$ ./arith.sh </span></span><br><span class="line"><span class="string">a + b : 30</span></span><br><span class="line"><span class="string">a - b : -10</span></span><br><span class="line"><span class="string">a * b : 200</span></span><br><span class="line"><span class="string">b / a : 2</span></span><br><span class="line"><span class="string">b % a : 0</span></span><br><span class="line"><span class="string">a 不等于 b</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>expr中乘号(*)前边必须加反斜杠(\)才能实现乘法运算；或使用 <strong>$((表达式))</strong> ，此处表达式中的 “*“ 不需要转义符号 “\“；</li>
<li>if…then…fi 是条件语句，后续将会讲解；</li>
<li>执行输出结果被注释，后续将会讲解。</li>
</ul>
<h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><p>关系运算符只支持数字，不支持字符串，除非字符串的值是数字。下表列出了常用的关系运算符，假定变量 a 为 10，变量 b 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>-eq</td>
<td>检测两个数是否相等，相等返回 true。</td>
<td>[ $a -eq $b ] 返回 false。</td>
</tr>
<tr>
<td>-ne</td>
<td>检测两个数是否不相等，不相等返回 true。</td>
<td>[ $a -ne $b ] 返回 true。</td>
</tr>
<tr>
<td>-gt</td>
<td>检测左边的数是否大于右边的，如果是，则返回 true。</td>
<td>[ $a -gt $b ] 返回 false。</td>
</tr>
<tr>
<td>-lt</td>
<td>检测左边的数是否小于右边的，如果是，则返回 true。</td>
<td>[ $a -lt $b ] 返回 true。</td>
</tr>
<tr>
<td>-ge</td>
<td>检测左边的数是否大于等于右边的，如果是，则返回 true。</td>
<td>[ $a -ge $b ] 返回 false。</td>
</tr>
<tr>
<td>-le</td>
<td>检测左边的数是否小于等于右边的，如果是，则返回 true。</td>
<td>[ $a -le $b ] 返回 true。</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                           </span></span><br><span class="line"><span class="comment"># scripte:  rela.sh                  </span></span><br><span class="line"><span class="comment"># author:   zyming                   </span></span><br><span class="line"><span class="comment"># date:     2024-12-9                </span></span><br><span class="line"><span class="comment"># funtion:  display relation operations </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -eq <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -eq <span class="variable">$b</span> : a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -eq <span class="variable">$b</span>: a 不等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ne <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -ne <span class="variable">$b</span>: a 不等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -ne <span class="variable">$b</span> : a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -gt <span class="variable">$b</span>: a 大于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -gt <span class="variable">$b</span>: a 不大于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -lt <span class="variable">$b</span>: a 小于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -lt <span class="variable">$b</span>: a 不小于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ge <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -ge <span class="variable">$b</span>: a 大于或等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -ge <span class="variable">$b</span>: a 小于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -le <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -le <span class="variable">$b</span>: a 小于或等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> -le <span class="variable">$b</span>: a 大于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行结果</span></span><br><span class="line">: <span class="string">&#x27;</span></span><br><span class="line"><span class="string">[zyming@localhost ~]$ ./rela.sh </span></span><br><span class="line"><span class="string">10 -eq 20: a 不等于 b</span></span><br><span class="line"><span class="string">10 -ne 20: a 不等于 b</span></span><br><span class="line"><span class="string">10 -gt 20: a 不大于 b</span></span><br><span class="line"><span class="string">10 -lt 20: a 小于 b</span></span><br><span class="line"><span class="string">10 -ge 20: a 小于 b</span></span><br><span class="line"><span class="string">10 -le 20: a 小于或等于 b</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="布尔运算符"><a href="#布尔运算符" class="headerlink" title="布尔运算符"></a>布尔运算符</h2><p>下表列出了常用的布尔运算符，假定变量 a 为 10，变量 b 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>!</td>
<td>非运算，表达式为 true 则返回 false，否则返回 true。</td>
<td>[ ! false ] 返回 true。</td>
</tr>
<tr>
<td>-o &#x2F; ||</td>
<td>或运算，有一个表达式为 true 则返回 true。</td>
<td>[ $a -lt 20 -o $b -gt 100 ] 返回 true。</td>
</tr>
<tr>
<td>-a &#x2F; &amp;&amp;</td>
<td>与运算，两个表达式都为 true 才返回 true。</td>
<td>[ $a -lt 20 -a $b -gt 100 ] 返回 false。</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                         </span></span><br><span class="line"><span class="comment"># scripte:  bool.sh                </span></span><br><span class="line"><span class="comment"># author:   zyming                 </span></span><br><span class="line"><span class="comment"># date:     2024-12-9              </span></span><br><span class="line"><span class="comment"># funtion:  display bool operations </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt 100 -a <span class="variable">$b</span> -gt 15 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 100 且 <span class="variable">$b</span> 大于 15 : 返回 true&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 100 且 <span class="variable">$b</span> 大于 15 : 返回 false&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt 100 -o <span class="variable">$b</span> -gt 100 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 100 或 <span class="variable">$b</span> 大于 100 : 返回 true&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 100 或 <span class="variable">$b</span> 大于 100 : 返回 false&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt 5 -o <span class="variable">$b</span> -gt 100 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 5 或 <span class="variable">$b</span> 大于 100 : 返回 true&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> 小于 5 或 <span class="variable">$b</span> 大于 100 : 返回 false&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行结果</span></span><br><span class="line">: <span class="string">&#x27;</span></span><br><span class="line"><span class="string">[zyming@localhost ~]$ ./bool.sh </span></span><br><span class="line"><span class="string">10 小于 100 且 20 大于 15 : 返回 true</span></span><br><span class="line"><span class="string">10 小于 100 或 20 大于 100 : 返回 true</span></span><br><span class="line"><span class="string">10 小于 5 或 20 大于 100 : 返回 false</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h2><p>下表列出了常用的字符串运算符，假定变量 a 为 “abc”，变量 b 为 “efg”：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>检测两个字符串是否相等，相等返回 true。</td>
<td>[ $a = $b ] 返回 false。</td>
</tr>
<tr>
<td>!=</td>
<td>检测两个字符串是否不相等，不相等返回 true。</td>
<td>[ $a != $b ] 返回 true。</td>
</tr>
<tr>
<td>-z</td>
<td>检测字符串长度是否为0，为0返回 true。与-n对偶</td>
<td>[ -z $a ] 返回 false。</td>
</tr>
<tr>
<td>-n</td>
<td>检测字符串长度是否不为 0，不为 0 返回 true。</td>
<td>[ -n “$a” ] 返回 true。</td>
</tr>
<tr>
<td><br /></td>
<td>检测字符串是否不为空，不为空返回 true。</td>
<td>[ $a ] 返回 true。</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                         </span></span><br><span class="line"><span class="comment"># scripte:  string.sh                </span></span><br><span class="line"><span class="comment"># author:   zyming                 </span></span><br><span class="line"><span class="comment"># date:     2024-12-9              </span></span><br><span class="line"><span class="comment"># funtion:  display string operations </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line">a=<span class="string">&quot;abc&quot;</span></span><br><span class="line">b=<span class="string">&quot;efg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> = <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> = <span class="variable">$b</span> : a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> = <span class="variable">$b</span>: a 不等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> != <span class="variable">$b</span> : a 不等于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> != <span class="variable">$b</span>: a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$a</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;-z <span class="variable">$a</span> : 字符串长度为 0&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;-z <span class="variable">$a</span> : 字符串长度不为 0&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$a</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;-n <span class="variable">$a</span> : 字符串长度不为 0&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;-n <span class="variable">$a</span> : 字符串长度为 0&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> : 字符串不为空&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> : 字符串为空&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h2><table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>-b file</td>
<td>检测文件是否是块设备文件，如果是，则返回 true。</td>
<td>[ -b $file ] 返回 false。</td>
</tr>
<tr>
<td>-c file</td>
<td>检测文件是否是字符设备文件，如果是，则返回 true。</td>
<td>[ -c $file ] 返回 false。</td>
</tr>
<tr>
<td>-d file</td>
<td>检测文件是否是目录，如果是，则返回 true。</td>
<td>[ -d $file ] 返回 false。</td>
</tr>
<tr>
<td>-f file</td>
<td>检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。</td>
<td>[ -f $file ] 返回 true。</td>
</tr>
<tr>
<td>-g file</td>
<td>检测文件是否设置了 SGID 位，如果是，则返回 true。</td>
<td>[ -g $file ] 返回 false。</td>
</tr>
<tr>
<td>-k file</td>
<td>检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。</td>
<td>[ -k $file ] 返回 false。</td>
</tr>
<tr>
<td>-p file</td>
<td>检测文件是否是有名管道，如果是，则返回 true。</td>
<td>[ -p $file ] 返回 false。</td>
</tr>
<tr>
<td>-u file</td>
<td>检测文件是否设置了 SUID 位，如果是，则返回 true。</td>
<td>[ -u $file ] 返回 false。</td>
</tr>
<tr>
<td>-r file</td>
<td>检测文件是否可读，如果是，则返回 true。</td>
<td>[ -r $file ] 返回 true。</td>
</tr>
<tr>
<td>-w file</td>
<td>检测文件是否可写，如果是，则返回 true。</td>
<td>[ -w $file ] 返回 true。</td>
</tr>
<tr>
<td>-x file</td>
<td>检测文件是否可执行，如果是，则返回 true。</td>
<td>[ -x $file ] 返回 true。</td>
</tr>
<tr>
<td>-s file</td>
<td>检测文件是否为空（文件大小是否大于0），不为空返回 true。</td>
<td>[ -s $file ] 返回 true。</td>
</tr>
<tr>
<td>-e file</td>
<td>检测文件（包括目录）是否存在，如果是，则返回 true。</td>
<td>[ -e $file ] 返回 true。</td>
</tr>
<tr>
<td>FILE1 -nt FILE2</td>
<td>FILE1 is newer (modification date) than FILE2</td>
<td></td>
</tr>
<tr>
<td>FILE1 -ot FILE2</td>
<td>FILE1 is older than FILE2</td>
<td></td>
</tr>
</tbody></table>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p>变量 file 表示文件 &#x2F;home&#x2F;zyming&#x2F;test.sh，它的大小为 6 字节，具有 rwx 权限。下面的代码，将检测该文件的各种属性：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"><span class="comment">#!bin/bash                         </span></span><br><span class="line"><span class="comment"># scripte:  test2.sh                </span></span><br><span class="line"><span class="comment"># author:   zyming                 </span></span><br><span class="line"><span class="comment"># date:     2024-12-9              </span></span><br><span class="line"><span class="comment"># funtion:  display test operations </span></span><br><span class="line"><span class="comment">#--------------------------------------------</span></span><br><span class="line"></span><br><span class="line">file=<span class="string">&quot;/home/zyming/test.sh&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -r <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件可读&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不可读&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -w <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件可写&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不可写&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -x <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件可执行&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不可执行&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件为普通文件&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件为特殊文件&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件是个目录&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不是个目录&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -s <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不为空&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件为空&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件存在&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;文件不存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="自增和自减操作符"><a href="#自增和自减操作符" class="headerlink" title="自增和自减操作符"></a>自增和自减操作符</h2><p>尽管 Shell 本身没有像 C、C++ 或 Java 那样的 ++ 和 – 操作符，但可以通过其他方式实现相同的功能。以下是一些常见的方法：</p>
<h3 id="使用-let-命令"><a href="#使用-let-命令" class="headerlink" title="使用 let 命令"></a>使用 let 命令</h3><p>let 命令允许对整数进行算术运算。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化变量</span></span><br><span class="line">num=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自增</span></span><br><span class="line"><span class="built_in">let</span> num++</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自减</span></span><br><span class="line"><span class="built_in">let</span> num--</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$num</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-进行算术运算"><a href="#使用-进行算术运算" class="headerlink" title="使用(())进行算术运算"></a>使用(())进行算术运算</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化变量</span></span><br><span class="line">num=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自增</span></span><br><span class="line">((num++)) <span class="comment"># 或者num=$((num ++))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自减</span></span><br><span class="line">((num--)) <span class="comment"># 或者num=$((num --))</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$num</span></span><br></pre></td></tr></table></figure>

<h1 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h1><h2 id="使用Here文档"><a href="#使用Here文档" class="headerlink" title="使用Here文档"></a>使用Here文档</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">注释内容...</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>以上例子中，: 是一个空命令，用于执行后面的 Here 文档，&lt;&lt;EOF 表示开启 Here 文档，EOF 是 Here 文档的标识符，在这两个标识符之间的内容都会被视为注释，不会被执行。EOF 也可以使用其他符号:</p>
<ul>
<li>COMMENT</li>
<li>单引号’</li>
<li>感叹号!</li>
</ul>
<h2 id="直接使用冒号"><a href="#直接使用冒号" class="headerlink" title="直接使用冒号"></a>直接使用冒号</h2><p>我们也可以使用了冒号 : 命令，并用单引号 ‘ 将多行内容括起来。由于冒号是一个空命令，这些内容不会被执行。格式为：: + 空格 + 单引号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">: <span class="string">&#x27;</span></span><br><span class="line"><span class="string">这是注释的部分。</span></span><br><span class="line"><span class="string">可以有多行内容。</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-shell-variable.html">Shell 变量 | 菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-shell-passing-arguments.html">Shell 传递参数 | 菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-shell-basic-operators.html">Shell 基本运算符 | 菜鸟教程</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/29/Linux-du/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/29/Linux-du/" class="post-title-link" itemprop="url">du磁盘占用分析指令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-11-29 11:16:20 / 修改时间：14:29:54" itemprop="dateCreated datePublished" datetime="2024-11-29T11:16:20+08:00">2024-11-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>​<strong>​<code>du</code>​</strong>​(<strong>d</strong>isk <strong>u</strong>sage的缩写，磁盘使用情况)是一个标准Unix程序，用于估量文件或文件夹的磁盘使用情况。</p>
<p>默认情况下，<code>du</code>​显示当前目录每个文件与目录的被分配磁盘空间的情况。链接文件将会显示其本身大小而非其链接对象；目录则会显示其内容的大小。</p>
<h1 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h1><ul>
<li><strong>检查某个目录的大小</strong>：用来查看一个目录及其子目录占用的空间，以便做清理或备份。</li>
<li><strong>找出占用大量磁盘空间的文件或目录</strong>：通过 <code>du</code>​ 命令，你可以定位磁盘占用较大的文件或子目录，以便做进一步操作。</li>
<li><strong>查看文件系统使用情况</strong>：可以通过限制深度来快速查看文件系统中各个目录的占用情况。</li>
</ul>
<h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>du [options] [file|directory…]</p>
<h2 id="定制化显示内容："><a href="#定制化显示内容：" class="headerlink" title="定制化显示内容："></a>定制化显示内容：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-h（human-readable）：以人类可读的格式显示文件大小（例如 KB、MB、GB 等）。</span></span><br><span class="line"><span class="built_in">du</span> -h /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-s（summarize）：只显示指定目录的总计大小，不显示子目录的大小。</span></span><br><span class="line"><span class="built_in">du</span> -sh /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-a（all）：显示目录下所有文件和子目录的磁盘使用情况，而不仅仅是目录。</span></span><br><span class="line"><span class="built_in">du</span> -ah /path/to/directory <span class="comment"># -s和-a存在冲突不能一起使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-c（total）：总计。</span></span><br><span class="line"><span class="built_in">du</span> -ch /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-d &lt;level&gt;：限制显示的目录深度。&lt;level&gt; 是你想显示的目录深度。例如，-d 1 </span></span><br><span class="line"><span class="comment">#只显示当前目录和它的一级子目录的磁盘使用情况。-d 0 等价于 -s</span></span><br><span class="line"><span class="built_in">du</span> -d 1 /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-L：计算符号链接（symlink）指向的文件的磁盘使用情况，而不是符号链接本身。</span></span><br><span class="line"><span class="built_in">du</span> -L /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-x：限制 du 仅对当前文件系统进行操作，避免跨越不同的挂载点。</span></span><br><span class="line"><span class="built_in">du</span> -x /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-exclude=&lt;pattern&gt;：排除匹配特定模式的文件或目录。</span></span><br><span class="line"><span class="built_in">du</span> --exclude=<span class="string">&quot;*.log&quot;</span> /path/to/directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#统计当前目录包含隐藏文件的磁盘使用情况</span></span><br><span class="line"><span class="built_in">du</span> -sk .[!.]* *| <span class="built_in">sort</span> -n</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li><p>du是一个很好的命令，可以帮助查询指定目录文件系统的磁盘使用情况，帮助定位目录下占用最多的文件和子目录。</p>
</li>
<li><p>du显示的是文件或目录的 <strong>磁盘占用空间</strong>，即文件在磁盘上实际使用的空间。这个值考虑了文件系统的块大小（block size）和文件的实际存储情况。</p>
</li>
<li><p>​<code>du</code>​ 考虑文件系统的块大小（通常为 4KB 或 8KB 等），因此可能会显示比文件实际大小更大的值。如果文件内容较小但占用了完整的磁盘块，则 <code>du</code>​ 会显示文件占用的最小块数。</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/20/Linux-ftp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/20/Linux-ftp/" class="post-title-link" itemprop="url">ftp服务与虚拟用户配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-11-20 14:10:39 / 修改时间：14:35:58" itemprop="dateCreated datePublished" datetime="2024-11-20T14:10:39+08:00">2024-11-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，即<strong>文件传输，</strong> 是一项基本的网络应用。很多时候有这样的需求：网站设计者将构成网站内容的文件批量上传到他们的Web服务器，计算机之间批量传输文件等，而ftp协议可以很好地满足这种需求。</p>
<p>ftp（file transport protocol）<strong>文件传输协议</strong>，是<strong>TCP&#x2F;IP</strong>协议组中的协议。ftp协议包含两个部分，1是服务器，2是客户端。其中ftp服务器用来存储文件，而客户端通过ftp协议访问ftp服务器上的资源。</p>
<p>默认情况下，ftp协议使用<strong>20和21端口</strong>，其中<strong>20用于传输数据</strong>，<strong>21用于传输控制信息</strong>。</p>
<h1 id="ftp服务（Very-Secure-FTP-Daemons-vsftpd）安装"><a href="#ftp服务（Very-Secure-FTP-Daemons-vsftpd）安装" class="headerlink" title="ftp服务（Very Secure FTP Daemons, vsftpd）安装"></a>ftp服务（Very Secure FTP Daemons, vsftpd）安装</h1><ol>
<li><p>yum下载</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install vsftpd</span><br></pre></td></tr></table></figure></li>
<li><p>开启ftp服务</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看ftp服务的状态</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status vsftpd <span class="comment"># 此时是inactive(dead)，同时发现CGroup行：</span></span><br><span class="line">                             <span class="comment"># ftp服务守护进程是/usr/sbin/vsftpd，</span></span><br><span class="line">                             <span class="comment"># 配置文件/etc/vsftpd/vsftpd.conf </span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start vsftpd <span class="comment"># 打开ftp服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> vsftpd <span class="comment"># 下次开机自己启动</span></span><br></pre></td></tr></table></figure></li>
<li><p>防火墙开通21端口</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为ftp开通21号端口</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --permanent --add-port=21/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --zone=public --permanent --add-service=ftp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload <span class="comment"># 重启防火墙</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="ftp客户端安装"><a href="#ftp客户端安装" class="headerlink" title="ftp客户端安装"></a>ftp客户端安装</h1><p>rhel8版本下，ftp客户端默认未安装，可在shell中进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ftp <span class="comment"># 仅输入ftp</span></span><br><span class="line">std输出&gt;&gt;bash: ftp: <span class="built_in">command</span> not found...</span><br><span class="line">std输出&gt;&gt;Install package <span class="string">&#x27;ftp&#x27;</span> to provide <span class="built_in">command</span> <span class="string">&#x27;ftp&#x27;</span>? [N/y] y  <span class="comment">#后面就自动安装了</span></span><br></pre></td></tr></table></figure>

<p>通过以上步骤就能使用ftp服务了，但是这样默认使用本地用户，为了提高系统的安全性，避免直接暴露系统账户，可以采用建立ftp虚拟用户的方式，满足不同场景的需求。</p>
<h1 id="虚拟用户配置"><a href="#虚拟用户配置" class="headerlink" title="虚拟用户配置"></a>虚拟用户配置</h1><h2 id="安装必要的软件"><a href="#安装必要的软件" class="headerlink" title="安装必要的软件"></a>安装必要的软件</h2><p>确保已经安装了 <code>vsftpd</code>​ 和 <code>db_util</code>​ 工具（用于管理虚拟用户数据库）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install libdb-utils</span><br></pre></td></tr></table></figure>

<h2 id="创建虚拟用户数据库"><a href="#创建虚拟用户数据库" class="headerlink" title="创建虚拟用户数据库"></a>创建虚拟用户数据库</h2><ol>
<li><p>编辑一个文本文件，记录用户的用户名和密码。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/vsftpd/virtual_users.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加以下内容</span></span><br><span class="line">user1</span><br><span class="line">password1</span><br><span class="line">user2</span><br><span class="line">password2</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li><p>转换为数据库格式</p>
<p> 使用 <code>db_load</code>​ 工具将上述文件转换为 Berkeley DB 格式：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> db_load -T -t <span class="built_in">hash</span> -f /etc/vsftpd/virtual_users.txt /etc/vsftpd/virtual_users.db</span><br></pre></td></tr></table></figure>

<p> 确保数据库文件的权限：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 600 /etc/vsftpd/virtual_users.db</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="配置pam认证"><a href="#配置pam认证" class="headerlink" title="配置pam认证"></a>配置pam认证</h2><p>修改PAM 配置文件（通常位于 <code>/etc/pam.d/vsftpd</code>​ 或 <code>/etc/pam.d/ftp</code>​）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/pam.d/vsftpd /etc/pam.d/vsftpd.bk</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/pam.d/vsftpd</span><br><span class="line"><span class="comment">#改为以下内容</span></span><br><span class="line">auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/virtual_users</span><br><span class="line">account required /lib64/security/pam_userdb.so db=/etc/vsftpd/virtual_users</span><br></pre></td></tr></table></figure>

<h2 id="配置vsftpd"><a href="#配置vsftpd" class="headerlink" title="配置vsftpd"></a>配置vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑vsftpd配置文件</span></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#确保包含以下内容</span></span><br><span class="line"><span class="comment"># 匿名和本地系统用户必须有一个为YES</span></span><br><span class="line">anonymous_enable=NO <span class="comment"># 若为YES，则登录用户名：anonymous，无需密码。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#本地系统用户</span></span><br><span class="line">local_enable=NO <span class="comment"># 启用才能启动虚拟用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用虚拟用户支持</span></span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=ftp <span class="comment"># 此处为宿主用户，默认使用ftp自带的用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#写权限</span></span><br><span class="line">write_enable=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">#虚拟用户的根目录，默认为/var/ftp/，若要更改则需以下设置</span></span><br><span class="line">chroot_local_user=YES <span class="comment"># 启用虚拟用户的 chroot 限制</span></span><br><span class="line">user_sub_token=<span class="variable">$USER</span> <span class="comment"># 设置多个虚拟用户占位符</span></span><br><span class="line">local_root=/home/ftp/<span class="variable">$USER</span> <span class="comment"># 设置到创建好的ftp目录下</span></span><br><span class="line">allow_writeable_chroot=YES <span class="comment"># 若不加此则报错：</span></span><br><span class="line">                           <span class="comment"># vsftpd: refusing to run with writable root inside chroot()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 PAM 配置文件</span></span><br><span class="line">pam_service_name=vsftpd</span><br></pre></td></tr></table></figure>

<h2 id="创建虚拟用户的目录"><a href="#创建虚拟用户的目录" class="headerlink" title="创建虚拟用户的目录"></a>创建虚拟用户的目录</h2><ol>
<li><p>创建一个根目录，并为虚拟用户设置独立的子目录：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /home/ftp/user1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /home/ftp/user2</span><br></pre></td></tr></table></figure></li>
<li><p>修改目录权限，使 <code>vsftpd</code>​ 能够访问：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> ftp:ftp /home/ftp/user1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> ftp:ftp /home/ftp/user2</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="重启-vsftpd-服务"><a href="#重启-vsftpd-服务" class="headerlink" title="重启 vsftpd 服务"></a>重启 vsftpd 服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart vsftpd</span><br></pre></td></tr></table></figure>

<h1 id="附加配置（可选）"><a href="#附加配置（可选）" class="headerlink" title="附加配置（可选）"></a>附加配置（可选）</h1><p><strong>日志记录</strong>： 在 <code>vsftpd.conf</code>​ 中启用日志记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xferlog_enable=YES</span><br><span class="line">xferlog_file=/var/log/vsftpd.log</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/LXWalaz1s1s/article/details/123779435">Linux基础篇——ftp的安装与配置_ftp安装-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/HinsCoder/article/details/130911658">【网络协议详解】——FTP系统协议（学习笔记）_ftp协议详解-CSDN博客</a></li>
</ol>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/08/Leetcode-9th/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/08/Leetcode-9th/" class="post-title-link" itemprop="url">No.9 回文数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-11-08 14:00:00 / 修改时间：14:20:00" itemprop="dateCreated datePublished" datetime="2024-11-08T14:00:00+08:00">2024-11-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>给你一个整数 <code>x</code>​ ，如果 <code>x</code>​ 是一个回文整数，返回 <code>true</code>​ ；否则，返回 <code>false</code>​ 。</p>
<p>回文数是指正序（从左向右）和倒序（从右向左）读都是一样的整数。例如，<code>121</code>​ 是回文，而 <code>123</code>​ 不是。</p>
<ul>
<li><p><strong>示例 1：</strong></p>
<p><strong>输入：</strong> x = 121<br><strong>输出：</strong> true</p>
</li>
<li><p><strong>示例 2：</strong></p>
<p><strong>输入：</strong> x = -121<br><strong>输出：</strong> false<br><strong>解释：</strong> 从左向右读, 为 -121 。 从右向左读, 为 121- 。因此它不是一个回文数。</p>
</li>
<li><p><strong>示例 3：</strong> ​</p>
<p><strong>输入：</strong> x = 10<br><strong>输出：</strong> false<br><strong>解释：</strong> 从右向左读, 为 01 。因此它不是一个回文数。</p>
</li>
</ul>
<h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><ol>
<li><p>最简单的就是将x转化为字符串，然后使用左右两个指针获取来进行对应比较，这里就不再赘述；</p>
</li>
<li><p>省去转化为字符串这一步，使用数学的方式获取对应位上的数字进行比较，这里给出C++代码：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 负数不是回文数</span></span><br><span class="line">		<span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="comment">// 获取位数digits，更简洁的办法可以用log10(Number)+1，</span></span><br><span class="line">		<span class="comment">// 但需除开Number为0的情况</span></span><br><span class="line">		<span class="type">int</span> digits = <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> tmp = x;</span><br><span class="line">		<span class="keyword">while</span> (tmp != <span class="number">0</span>) &#123;</span><br><span class="line">			tmp /= <span class="number">10</span>;</span><br><span class="line">			digits++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 第1位与最后1位对应要相等，以此类推，如果有反例则不是回文</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= digits / <span class="number">2</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (((x / (<span class="type">int</span>)(<span class="built_in">pow</span>(<span class="number">10.0</span>, digits - i - <span class="number">1</span>))) % <span class="number">10</span>) !=</span><br><span class="line">				((x / (<span class="type">int</span>)(<span class="built_in">pow</span>(<span class="number">10.0</span>, i))) % <span class="number">10</span>))</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>使用反转数字（revertedNum）的方式（题解给出的“奇淫技巧”），这里给出两个形象的例子帮助理解：</p>
<hr>
<ol>
<li><p>x &#x3D; 121</p>
</li>
<li><p>x &#x3D; 12 | revertedNum &#x3D; 1</p>
</li>
<li><p>x &#x3D; 1 | revertedNum &#x3D; 12</p>
</li>
<li><p>if revertedNum&#x2F;10 &#x3D;&#x3D; x，是回文数，反之则不是  &#x2F;&#x2F; 上一步revertedNum &gt; x 说明左右两部已经形成，而中间是2或是3都无影响，因此除去之后得到对应的两个要素</p>
</li>
</ol>
<hr>
<ol>
<li>x &#x3D; 2112</li>
<li>x &#x3D; 211 | revertedNum &#x3D; 2</li>
<li>x &#x3D; 21 | revertedNum &#x3D; 21</li>
<li>if revertedNum &#x3D;&#x3D; x，是回文数，反之则不是  &#x2F;&#x2F; 上一步revertedNum &#x3D;&#x3D; x 说明左右两部已经形成，因此除去之后，得到左半部和右半部</li>
</ol>
<hr>
<p> 根据上述的两个例子，去除特殊情况（x&#x3D;10，x&#x3D;100不是回文），得到如下代码：</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 负数不是回文数；除0以外，个位为0不是回文</span></span><br><span class="line">		<span class="keyword">if</span> (x &lt; <span class="number">0</span> || x % <span class="number">10</span> == <span class="number">0</span> &amp;&amp; x/<span class="number">10</span> != <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="type">int</span> revertedNum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>( revertedNum &lt; x )&#123;</span><br><span class="line">			revertedNum = revertedNum * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">			x /= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> revertedNum/<span class="number">10</span> == x || revertedNum == x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/06/Linux-raid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/06/Linux-raid/" class="post-title-link" itemprop="url">磁盘阵列RAID</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-06 16:50:10" itemprop="dateCreated datePublished" datetime="2024-11-06T16:50:10+08:00">2024-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-07 10:20:28" itemprop="dateModified" datetime="2024-11-07T10:20:28+08:00">2024-11-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>RAID的全称是R</strong>edundant <strong>A</strong>rray of <strong>I</strong>ndependent <strong>D</strong>isks，中文译作<strong>独立硬盘冗余阵列，</strong> 简称<strong>磁盘阵列。</strong> RAID利用虚拟化存储技术把多个硬盘组合起来，成为一个或多个硬盘阵列组，目的为<strong>提升读取性能</strong>或<strong>数据备份</strong>，或是两者同时提升。</p>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>RAID分为多种存储模式，亦或称<strong>多种层级</strong>，RAID层级的命名会以RAID开头并带数字，例如：RAID 0、RAID 1、RAID 10等等。每种层级在理论上均有其优缺点，要么在上述两个目的之间寻求平衡，要么为单一的目的。</p>
<p>简单来说，RAID可以看成一块<strong>逻辑硬盘</strong>，而不去管实际的物理实现。</p>
<h1 id="RAID-0（条带化）-RAID-1（镜像）"><a href="#RAID-0（条带化）-RAID-1（镜像）" class="headerlink" title="RAID 0（条带化）&#x2F;RAID 1（镜像）"></a>RAID 0（条带化）&#x2F;RAID 1（镜像）</h1><p><strong>RAID 0</strong>亦称为带区卷，它将两个以上的磁盘并联起来，成为一个大容量的磁盘。RAID 0模式下，数据被分成固定大小的块，分散存储在多个磁盘驱动器上，而不进行冗余备份。例如，如果有两个驱动器（驱动器0和驱动器1），数据A分为8块，其第一个部分A1存储在驱动器0上，第二个部分A2存储在驱动器1上，以此类推。这种<strong>条带化（striping）</strong> 的方式可以同时从多个驱动器读取或写入数据，从而提高系统的性能。RAID 0的优势是高速读写，但一旦其中一个磁盘故障，整个数据集将无法恢复。</p>
<table>
<thead>
<tr>
<th><img src="/2024/11/06/Linux-raid/image-20241104165843-twjv8ax.png" alt="image-20241105100554-kxizp6z"></th>
<th><img src="/2024/11/06/Linux-raid/image-20241105100554-kxizp6z.png" alt="image-20241105100554-kxizp6z"></th>
</tr>
</thead>
</table>
<p><strong>RAID 1</strong>使用<strong>镜像</strong>（mirroring）技术，将数据同时写入两个磁盘。这样可以提供冗余备份，如果一个磁盘发生故障，数据仍然可从另一个磁盘恢复。RAID 1的优势是<strong>高可靠性</strong>，但成本较高，因为需要两倍的磁盘容量。​​</p>
<h1 id="RAID-10（镜像-条带化）-RAID-01（条带化-镜像）"><a href="#RAID-10（镜像-条带化）-RAID-01（条带化-镜像）" class="headerlink" title="RAID 10（镜像+条带化）&#x2F;RAID 01（条带化+镜像）"></a>RAID 10（镜像+条带化）&#x2F;RAID 01（条带化+镜像）</h1><p><strong>RAID 10</strong>是将RAID 1和RAID 0两种技术结合起来的一种RAID层级。RAID 10也需要至少<strong>4块硬盘</strong>，将它们分为两组，每组至少有两块硬盘。RAID 10实现方式为：先实现两块磁盘的镜像复制(RAID 1)，并且这样的设定有多组，然后将两个RAID 1组中的数据进行条带化(RAID 0)。RAID10的优点是<strong>数据可靠性高</strong>，<strong>读写速度快</strong>，适合高性能应用和数据库等。它能容忍多个磁盘故障，只要故障的磁盘不在同一组内。</p>
<table>
<thead>
<tr>
<th><img src="/2024/11/06/Linux-raid/image-20241105135050-i9iq6q2.png" alt="image-20241105135050-i9iq6q2"></th>
<th><img src="/2024/11/06/Linux-raid/image-20241105135106-z062oh2.png" alt="image-20241105135106-z062oh2"></th>
</tr>
</thead>
</table>
<p><strong>RAID 01</strong>则与RAID 10相反，RAID 01的数据写入方式是将数据分成两份，分别写入两个RAID 0组中，然后再将两个RAID 0组中的数据进行镜像复制(RAID 1)。RAID 01的优点是可以提高读写速度和数据冗余，适合大型文件传输和视频编辑等。RAID 01提供了高性能和高可靠性，但与RAID 10相比，它<strong>更容易受到磁盘故障带来的影响，</strong> 因为当RAID 10有一个硬盘受损，其余硬盘会继续运作。RAID 01只要有一个硬盘受损，同组RAID 0的所有硬盘都会停止运作，只剩下其他组的硬盘运作。</p>
<h1 id="RAID-5-RAID-6"><a href="#RAID-5-RAID-6" class="headerlink" title="RAID 5&#x2F;RAID 6"></a>RAID 5&#x2F;RAID 6</h1><p><strong>RAID 5</strong>使用数据条带化的方式将数据分散存储在多个磁盘驱动器上，并通过分布式<strong>奇偶校验</strong>实现数据的冗余备份。数据和奇偶校验信息被组织成数据块，其中奇偶校验信息被分布式存储在不同的驱动器上。当写入数据时，奇偶校验信息也会被更新。如果其中一个驱动器发生故障，系统可以通过重新计算奇偶校验信息来恢复丢失的数据。这种方式可以同时提供性能增强和数据冗余。</p>
<table>
<thead>
<tr>
<th><img src="/2024/11/06/Linux-raid/image-20241105143626-37gs2nd.png" alt="image-20241105143626-37gs2nd"></th>
<th><img src="/2024/11/06/Linux-raid/image-20241105143635-9wlyiuo.png" alt="image-20241105143635-9wlyiuo"></th>
</tr>
</thead>
</table>
<p>与RAID 5相比，<strong>RAID 6</strong>增加<strong>第二个独立的奇偶校验信息块</strong>。两个独立的奇偶系统使用不同的算法，数据的可靠性非常高，任意两块磁盘同时失效时不会影响数据完整性。RAID 6需要分配给奇偶校验信息更大的磁盘空间和额外的校验计算，相对于RAID 5有更大的IO操作量和计算量，其“写性能”强烈取决于具体的实现方案，因此RAID 6通常不会通过软件方式来实现 ，而更可能通过硬件方式实现。</p>
<h1 id="RAID-50"><a href="#RAID-50" class="headerlink" title="RAID 50"></a>RAID 50</h1><p><strong>RAID 50</strong>是RAID 5与RAID 0的组合，先作RAID 5，再作RAID 0，也就是对多组RAID 5彼此构成Stripe访问。由于RAID 50是以RAID 5为基础，而RAID 5至少需要3颗硬盘，因此要以多组RAID 5构成RAID 50，至少需要6颗硬盘。以RAID 50最小的6颗硬盘配置为例，先把6颗硬盘分为2组，每组3颗构成RAID 5，如此就得到两组RAID 5，然后再把两组RAID 5构成RAID 0。</p>
<p>RAID 50在底层的任一组或多组RAID 5中出现<strong>1颗硬盘损坏</strong>时，仍能维持运作，不过如果任一组RAID 5中出现2颗或2颗以上硬盘损毁，整组RAID 50就会失效。</p>
<p>RAID 50由于在上层把多组RAID 5构成Stripe，性能比起单纯的RAID 5高，容量利用率比RAID 5要低。比如同样使用9颗硬盘，由各3颗RAID 5再组成RAID 0的RAID 50，每组RAID 5浪费一颗硬盘，利用率为(1-3&#x2F;9)，RAID 5则为(1-1&#x2F;9)。</p>
<h1 id="RAID-60"><a href="#RAID-60" class="headerlink" title="RAID 60"></a>RAID 60</h1><p><strong>RAID 60</strong>是RAID 6与RAID 0的组合：先作RAID 6，再作RAID 0。换句话说，就是对两组以上的RAID 6作Stripe访问。RAID 6至少需具备4颗硬盘，所以RAID 60的最小需求是8颗硬盘。</p>
<p>由于底层是以RAID 6组成，所以RAID 60可以容许任一组RAID 6中<strong>损毁最多2颗硬盘</strong>，而系统仍能维持运作；不过只要底层任一组RAID 6中损毁3颗硬盘，整组RAID 60就会失效，当然这种情况的概率相当低。</p>
<p>比起单纯的RAID 6，RAID 60的上层透过结合多组RAID 6构成Stripe访问，因此性能较高。不过使用门槛高，而且容量利用率低是较大的问题。</p>
<p>接下来对以上给出的RAID层级进行比较。</p>
<h1 id="磁盘阵列比较"><a href="#磁盘阵列比较" class="headerlink" title="磁盘阵列比较"></a>磁盘阵列比较</h1><p>这里给出wiki的磁盘阵列比较表，假设我们手里有n块磁盘：</p>
<table>
<thead>
<tr>
<th>RAID等级</th>
<th>最少硬盘</th>
<th>最大容错</th>
<th>可用容量</th>
<th>读取性能</th>
<th>写入性能</th>
<th>安全性</th>
<th>目的</th>
<th>应用产业</th>
</tr>
</thead>
<tbody><tr>
<td>单一硬盘</td>
<td>(参考)</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>无</td>
<td></td>
<td></td>
</tr>
<tr>
<td>JBOD</td>
<td>1</td>
<td>0</td>
<td>n</td>
<td>1</td>
<td>1</td>
<td>无（同RAID 0）</td>
<td>增加容量</td>
<td>个人（暂时）存储备份</td>
</tr>
<tr>
<td>0</td>
<td>2</td>
<td>0</td>
<td>n</td>
<td>n</td>
<td>n</td>
<td>一个硬盘异常，全部资料都会异常</td>
<td>追求最大容量、速度</td>
<td>影片剪接缓存用途</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>n-1</td>
<td>1</td>
<td>n</td>
<td>1</td>
<td>高，一个正常即可</td>
<td>追求最大安全性</td>
<td>个人、企业备份</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>1</td>
<td>n-1</td>
<td>n-1</td>
<td>n-1</td>
<td>中下至中</td>
<td>追求最大容量、最小预算</td>
<td>个人、小型企业备份</td>
</tr>
<tr>
<td>6</td>
<td>4</td>
<td>2</td>
<td>n-2</td>
<td>n-2</td>
<td>n-2</td>
<td>中至中高,仅安全性较RAID 5高</td>
<td>同RAID 5，但较安全</td>
<td>个人、企业备份</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>综合RAID 0&#x2F;1优点，理论速度较快</td>
<td>大型数据库、服务器</td>
</tr>
<tr>
<td>50</td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>提升资料安全</td>
<td></td>
</tr>
<tr>
<td>60</td>
<td>8</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>高</td>
<td>提升资料安全</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>JBOD（Just a Bunch Of Disks）指将数个物理硬盘，在操作系统中合并成一个逻辑硬盘，以直接增加容量；</li>
<li>依不同 RAID 厂商实现算法对于性能表现会有不同，以上性能只是理论论述。</li>
</ul>
<h1 id="实现模式"><a href="#实现模式" class="headerlink" title="实现模式"></a>实现模式</h1><p>RAID根据其实现方式可分为<strong>软件RAID</strong>和<strong>硬件RAID</strong>。其区别在于硬件RAID可以逻辑上看成是完整的一块磁盘，因此硬件RAID的装置文件名为&#x2F;dev&#x2F;sd[a-p]，而软件RAID则是<strong>系统仿真</strong>的，使用系统的装置文件，文件名为&#x2F;dev&#x2F;md[0-…]。</p>
<h2 id="软件RAID"><a href="#软件RAID" class="headerlink" title="软件RAID"></a>软件RAID</h2><p>主要由CPU处理存储作业，缺点为耗损较多CPU资源运算RAID，优点则是价格低。</p>
<ul>
<li>硬件辅助RAID（Hardware-Assisted RAID）：需要一张<strong>伪RAID卡</strong>，以及厂商所提供的驱动程序，但此类RAID卡仍然借助CPU进行运算。此类RAID卡的阵列较易迁移到其他电脑，其RAID功能靠执行于操作系统的厂商驱动程序和CPU运算提供。</li>
<li>操作系统的RAID功能：如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Linux" title="Linux">Linux</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/FreeBSD" title="FreeBSD">FreeBSD</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Windows_Server" title="Windows Server">Windows Server</a>等操作系统内置RAID功能。</li>
<li>Windows10内置的磁盘管理有五种模式：</li>
</ul>
<p><strong>简单卷</strong>：独立运作的基本分区。若PC上只有一个物理磁盘，那么只能创建简单卷。</p>
<p><strong>跨距卷（跨区卷）</strong> ：将不同物理磁盘的多个未配置空间合并为一个逻辑扇区。资料的存放机制是由第一颗硬盘开始依序往后存放，操作系统会视为一个硬盘。如果任一个物理硬盘损毁，则该逻辑扇区上的所有资料将无法救回。<mark>（可看成RAID 0）</mark></p>
<p><strong>等量卷（带区卷）</strong> ：由两个或多个物理磁盘的相同容量空间组成。资料分布在多个物理磁盘中，可以提高性能。<mark>（可看成RAID 0）</mark></p>
<p><strong>镜像卷</strong>：将两个或多个物理磁盘中创建完全相同的资料副本，即使其中一个物理硬盘损坏，资料仍然可以从其他冗余副本中获取，具有容错空间。若物理磁盘容量大小不同，实际可用空间将等于最小的物理磁盘。<mark>（可看成RAID 1）</mark></p>
<p><strong>RAID-5卷</strong>：最大可支持9.4ZB的硬盘容量，最多可创建128个分区。</p>
<h2 id="硬件RAID"><a href="#硬件RAID" class="headerlink" title="硬件RAID"></a>硬件RAID</h2><ul>
<li>基于<strong>主板</strong>的磁盘阵列：只需要主板支持即可（通常是<strong>芯片组内置</strong>的RAID功能，如Intel Matrix RAID，后来变为<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Intel_Rapid_Storage_Technology" title="Intel Rapid Storage Technology">Intel Rapid Storage Technology</a>），不需要任何磁盘阵列卡。若主板损坏，可能难以购买同款主板重建RAID。</li>
<li>RAID卡：与Fake RAID卡相比，RAID卡基于片上RAID (ROC, RAID-on-chip)，具有独立的CPU资源及独立BIOS。优点是<strong>读写性能快</strong>，<strong>不占用服务器资源</strong>，<strong>可用于任何操作系统</strong>。然而，其缺点在于<strong>售价较高</strong>，且性能与价格呈正相关。此外，使用RAID卡还可能因内置的自检程序而导致电脑<strong>启动时间增加</strong>。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/RAID">RAID - 维基百科，自由的百科全书</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2304179">完全图解RAID存储技术：RAID 0、1、5、6、10、50、60-腾讯云开发者社区-腾讯云</a></p>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/Linux-lvm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/01/Linux-lvm/" class="post-title-link" itemprop="url">LVM磁盘空间管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-01 13:08:12" itemprop="dateCreated datePublished" datetime="2024-11-01T13:08:12+08:00">2024-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-08 09:26:54" itemprop="dateModified" datetime="2024-11-08T09:26:54+08:00">2024-11-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="什么是LVM，以及PV，PE，VG，LV等重要概念。"><a href="#什么是LVM，以及PV，PE，VG，LV等重要概念。" class="headerlink" title="什么是LVM，以及PV，PE，VG，LV等重要概念。"></a>什么是LVM，以及PV，PE，VG，LV等重要概念。</h1><p><strong>LVM</strong>（Logical Volume Manager）本文译作逻辑卷管理器，是一种磁盘管理技术，为操作系统提供了更为灵活的管理存储设备方式。LVM提供了如下组件：</p>
<p><strong>物理卷</strong>（Physical Volume, PV），LVM 的基础存储设备，通常是物理硬盘、分区或 LVM 兼容的设备。</p>
<p><strong>卷组</strong>（Volume Group, VG），由一个或多个物理卷组成的逻辑存储池。卷组中的空间可以被多个逻辑卷共享。</p>
<p><strong>逻辑卷</strong>（Logical Volume, LV），从卷组中划分出的存储单元，类似于传统分区。逻辑卷可以格式化为文件系统并用于存储数据。</p>
<p><strong>物理扩展</strong>（Physical Extent, PE），物理卷被划分为多个相同大小的块，这些块就是物理扩展。每个物理扩展的大小通常是 4 MB 或 8 MB，具体取决于系统配置。</p>
<p>LVM技术流程：<strong>磁盘划分为PV —&gt;</strong>  <strong>PV组成了VG，同时设置了PE大小 —&gt;</strong>  <strong>从VG中划分出LV，其结构示意图如下所示：</strong></p>
<p>​<img src="/2024/11/01/Linux-lvm/image-20241031133756-srwg8kl.png" alt="image" title="LVM结构示意图">​</p>
<h2 id="LVM的原理"><a href="#LVM的原理" class="headerlink" title="LVM的原理"></a>LVM的原理</h2><p><strong>将底层的物理硬盘封装起来，然后以逻辑卷的方式呈现给上层应用。</strong> 通过这种方式可以只关心封装后的逻辑卷，而不去关注物理底层。这样做的优点有2个：</p>
<ol>
<li>文件系统可以跨磁盘存储，存储空间利用率得到提升；</li>
<li>可以灵活对系统磁盘扩容，逻辑层面上不受任何影响；</li>
</ol>
<p>文件系统创建流程：</p>
<ol>
<li><p>设置待操作磁盘或分区的SYSTEM ID（8e）</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdisk [disk/partion] <span class="comment"># 磁盘或分区的绝对路径</span></span><br><span class="line"></span><br><span class="line">输入n -&gt; p -&gt; [可用分区号] -&gt; [first sector] -&gt; [last sector]或+size&#123;K,M,G&#125; -&gt; </span><br><span class="line">t -&gt; 83(Linux)或8e(Linux LVM) -&gt; w <span class="comment"># m查看帮助 n+p选择主分区</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建PV</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvcreate [disk/partion] <span class="comment"># 磁盘或分区的绝对路径</span></span><br><span class="line"></span><br><span class="line">pvs <span class="comment"># 查看物理卷</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建VG</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用默认的PE大小</span></span><br><span class="line">vgcreate [vg_name] [pv_name] <span class="comment"># pv_name表示磁盘或分区的绝对路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定PE大小</span></span><br><span class="line">vgcreate -s [size] [new_vg] [pv_name] <span class="comment"># size可以是m,g,t</span></span><br><span class="line"></span><br><span class="line">vgs <span class="comment"># 查看卷组</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建LV</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定lv大小</span></span><br><span class="line">lvcreate -n [lv_name] -L [lv_size] [vg_name] <span class="comment"># lv_size为lv的实际大小</span></span><br><span class="line"></span><br><span class="line">lvs <span class="comment"># 查看逻辑卷</span></span><br></pre></td></tr></table></figure></li>
<li><p>格式化LV</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t [ext3/ext4/xfs] /dev/[vg_name]/[lv_name]</span><br><span class="line">或者</span><br><span class="line">mkfs.[ext3/ext4/xfs] /dev/[vg_name]/[lv_name]</span><br></pre></td></tr></table></figure></li>
<li><p>文件系统挂载到系统目录</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mount [lv_name] [absolute_path]</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件系统</span></span><br><span class="line"><span class="built_in">df</span> -hT <span class="comment"># h人性化的大小，m,g,t；T文件系统类型（xfs...）</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>以下为上述流程的示意图：</p>
<p>​<img src="/2024/11/01/Linux-lvm/image-20241031152224-qmf0leb.png" alt="image-20241031152224-qmf0leb" title="文件系统建立流程">​</p>
<h2 id="LVM扩容"><a href="#LVM扩容" class="headerlink" title="LVM扩容"></a>LVM扩容</h2><p>在LVM扩容之前，需要思考的是：VG剩余大小是否大于所需大小，本文首先给出满足此条件下的情形：</p>
<ol>
<li><p>追加LV</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#追加lv大小</span></span><br><span class="line">lvextend -L +[lv_size] /dev/[vg_name]/[lv_name] <span class="comment"># lv_size为lv的增加大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定lv最终大小</span></span><br><span class="line">lvextend -L [lv_size] /dev/[vg_name]/[lv_name] <span class="comment"># lv_size为lv的最终大小</span></span><br></pre></td></tr></table></figure></li>
<li><p>在LV扩容后，文件系统也要扩容，才能真正使用</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#xfs</span></span><br><span class="line">xfs_growfs /dev/[vg_name]/[lv_name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#ext3/ext4</span></span><br><span class="line">resize2fs /dev/[vg_name]/[lv_name]</span><br></pre></td></tr></table></figure></li>
</ol>
<p>接下来是不满足此条件的情形：</p>
<ol>
<li>首先确定有多余的磁盘或者分区，按文件系统创建流程建立PV</li>
<li><pre><code class="bash"> #扩充卷组池
 vgextend [vg_name] [pv_name] # pv_name为新创建未使用的PV
</code></pre>
</li>
<li>扩充之后如果VG剩余大小仍然不满足，继续扩充，反之则按满足此条件的情形进行扩容。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/67166867">LVM——让Linux磁盘空间的弹性管理 - 知乎</a></p>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/29/Linux-ug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/29/Linux-ug/" class="post-title-link" itemprop="url">Linux账号和群组</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-10-29 09:08:03 / 修改时间：09:14:25" itemprop="dateCreated datePublished" datetime="2024-10-29T09:08:03+08:00">2024-10-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Linux系统登录需要用户名和密码，但是不同的用户拥有不同的权限。有一位特殊的存在：<strong>root——</strong> 系统管理员，它在系统中拥有全部权限，可以管理用户的文件权限、目录权限等等。接下来就围绕账号与群组进行具体讨论。</p>
<h1 id="Linux账号与群组"><a href="#Linux账号与群组" class="headerlink" title="Linux账号与群组"></a>Linux账号与群组</h1><h2 id="UID和GID"><a href="#UID和GID" class="headerlink" title="UID和GID"></a>UID和GID</h2><p>对于用户，记住Linux系统的用户名和密码足矣，然而对于Linux主机，则需要记住用户的UID（User ID）和密码。首先我们要有一个概念：<strong>Linux系统由文件组成</strong>，<strong>包括目录也是文件组成。</strong> Linux规定所有的配置文件都保存在&#x2F;etc目录下，而每个用户名和UID的对应则保存在&#x2F;etc&#x2F;passwd文件中。以前用户的密码也保存在&#x2F;etc&#x2F;passwd文件中，但是目前用户的密码在&#x2F;etc&#x2F;shadow文件中密文保存。</p>
<p>每个用户都必须属于一个组，在未指定所属组的情况下，用户的组为自己本身。同样，组由于GID（Group ID）被Linux主机记住，组名和GID的对应保存在&#x2F;etc&#x2F;group文件中。</p>
<p>每个Linux文件都属于用户和组，Linux系统依据&#x2F;etc&#x2F;passwd和&#x2F;etc&#x2F;group中的内容，找到UID&#x2F;GID对应的用户名和组名显示出来。因此，若随意更改&#x2F;etc&#x2F;passwd中用户的UID，会导致此用户的文件无法显示名字，并且&#x2F;home&#x2F;用户 无法登入（因为UID更改，而家目录所属UID未变）。</p>
<h2 id="用户账号与群组"><a href="#用户账号与群组" class="headerlink" title="用户账号与群组"></a>用户账号与群组</h2><p>用户登录Linux系统，需要利用tty1~tty6终端机的login接口，并且输入用户名和密码。或者使用ssh进行远程登录。而输入用户名和密码后，Linux系统的验证流程如下：</p>
<ol>
<li>进入&#x2F;etc&#x2F;passwd，查找是否存在这个用户名，如果有再读出UID和GID，shell和家目录。</li>
<li>进入&#x2F;etc&#x2F;shadow，核验用户名和密码是否对应，如果对应则用户进入到Shell界面。</li>
</ol>
<h3 id="etc-passwd的每一行代表了一个用户，而其中的某些为系统用户，例如bin，deamon等等。"><a href="#etc-passwd的每一行代表了一个用户，而其中的某些为系统用户，例如bin，deamon等等。" class="headerlink" title="&#x2F;etc&#x2F;passwd的每一行代表了一个用户，而其中的某些为系统用户，例如bin，deamon等等。"></a>&#x2F;etc&#x2F;passwd的每一行代表了一个用户，而其中的某些为系统用户，例如bin，deamon等等。</h3><p>而每一行的固定格式为：</p>
<p>用户名：密码（x）：UID：GID：用户信息说明栏：家目录：Shell</p>
<p><strong>需注意，UID为0代表用户为系统管理员，因此root的UID为0，除此之外设置其余用户的UID为0也可以做到让其变为系统管理员。</strong></p>
<h3 id="etc-shadow的每一行存储了密码相关的字段，固定格式为："><a href="#etc-shadow的每一行存储了密码相关的字段，固定格式为：" class="headerlink" title="&#x2F;etc&#x2F;shadow的每一行存储了密码相关的字段，固定格式为："></a>&#x2F;etc&#x2F;shadow的每一行存储了密码相关的字段，固定格式为：</h3><p>用户名：密码：最近更改密码的日期：密码不可更动的天数：密码需要重新更动的天数：密码需要变更期限前的提醒天数：密码过期后的宽限天数：用户失效日期：保留字段</p>
<p>举个例子：</p>
<p>root:xxx:16659:5:60:7:5:16679:</p>
<p>密码可更改的日期：16664</p>
<p>密码提醒更改的日期：16722-16729</p>
<p>密码更改宽限的日期：16734</p>
<p>用户失效日期：16679</p>
<p>其中，&#x2F;etc&#x2F;shadow中查看加密方式，$1$表示MD5加密，$5$表示SHA-256，$6$表示SHA-512。</p>
<h3 id="etc-group的每一行代表一个群组，格式为："><a href="#etc-group的每一行代表一个群组，格式为：" class="headerlink" title="&#x2F;etc&#x2F;group的每一行代表一个群组，格式为："></a>&#x2F;etc&#x2F;group的每一行代表一个群组，格式为：</h3><p>组名：密码：GID：支持的用户名</p>
<h3 id="账号相关文件之间的UID-GID与密码相关性示意图"><a href="#账号相关文件之间的UID-GID与密码相关性示意图" class="headerlink" title="账号相关文件之间的UID&#x2F;GID与密码相关性示意图"></a>账号相关文件之间的UID&#x2F;GID与密码相关性示意图</h3><p>​<img src="/2024/10/29/Linux-ug/img12-20241017163842-kxs91dn.png" alt="img12-20241017163842-kxs91dn">​</p>
<h2 id="群组"><a href="#群组" class="headerlink" title="群组"></a>群组</h2><p>有效群组（effective group）：每个用户可以同属多个群组，用户的有效群组决定了新建文件的所属组。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">groups</span> [user]</span><br><span class="line"></span><br><span class="line">std输出&gt;&gt; dmtsai wheel <span class="built_in">users</span> <span class="comment">#其中，第一个群组为有效群组</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newgrp [group] <span class="comment">#在所属群组的范围中，临时切换有效群组，退出当前shell即还原有效群组</span></span><br></pre></td></tr></table></figure>

<p>初始群组（initial group）：用户一登录系统便拥有初始群组的所有权限。</p>
<h3 id="etc-gshadow格式"><a href="#etc-gshadow格式" class="headerlink" title="&#x2F;etc&#x2F;gshadow格式"></a>&#x2F;etc&#x2F;gshadow格式</h3><p>组名：密码：群组管理员账号：群组成员</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Linux账户与群组是Linux系统权限划分的有效工具，不同角色，不同群组可以有不同的权限。</p>
<h1 id="账号和群组管理"><a href="#账号和群组管理" class="headerlink" title="账号和群组管理"></a>账号和群组管理</h1><h2 id="新增账号"><a href="#新增账号" class="headerlink" title="新增账号"></a>新增账号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通建立账号</span></span><br><span class="line">useradd [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定账号UID</span></span><br><span class="line">useradd -u 10250 [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定初始群组</span></span><br><span class="line">useradd -g [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定附加群组</span></span><br><span class="line">useradd -G [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#不指定家目录</span></span><br><span class="line">useradd -M [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定家目录</span></span><br><span class="line">useradd -d [绝对路径]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定shell</span></span><br><span class="line">useradd -s [shell]</span><br><span class="line"></span><br><span class="line"><span class="comment">#普通建立账号的默认值</span></span><br><span class="line">useradd -D</span><br><span class="line"></span><br><span class="line">std输出&gt;&gt;GROUP=100</span><br><span class="line">std输出&gt;&gt;HOME=/home</span><br><span class="line">std输出&gt;&gt;INACTIVE=-1</span><br><span class="line">std输出&gt;&gt;EXPIRE=</span><br><span class="line">std输出&gt;&gt;SHELL=/bin/bash</span><br><span class="line">std输出&gt;&gt;SKEL=/etc/skel</span><br><span class="line">std输出&gt;&gt;CREATE_MAIL_SPOOL=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="etc-default-useradd"><a href="#etc-default-useradd" class="headerlink" title="&#x2F;etc&#x2F;default&#x2F;useradd"></a>&#x2F;etc&#x2F;default&#x2F;useradd</h3><p>普通建立账号的默认值可从本文件编辑，其中：</p>
<ol>
<li>GROUP&#x3D;100，为公共群组的GID，而RHEL、CENTOS中为私有群组，因此GID会由系统自动分配</li>
<li>HOME&#x3D;&#x2F;home，为用户家目录的基础目录（basedir）</li>
<li>INACTIVE&#x3D;-1，密码过期后是否会失效，过多久失效的设置</li>
<li>EXPIRE&#x3D;，账号的失效日期</li>
<li>SHELL&#x3D;&#x2F;bin&#x2F;bash，默认SHELL名称</li>
<li>SKEL&#x3D;&#x2F;etc&#x2F;skel，用户家目录参考目录，新建账号时会从&#x2F;etc&#x2F;skel&#x2F;*复制到用户家目录</li>
<li>CREATE_MAIL_SPOOL&#x3D;yes，是否建立用户的mailbox</li>
</ol>
<p>除了以上账号的基本设定值以外，UID&#x2F;GID和密码等其他默认参数由&#x2F;etc&#x2F;login.defs决定，此处省略对login.defs的介绍。</p>
<p>用户建立以后，需要马上设定密码，否则无法登录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通设置密码</span></span><br><span class="line">passwd [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#锁定用户</span></span><br><span class="line">passwd -l [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#解锁用户</span></span><br><span class="line">passwd -u [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看用户的shadow信息</span></span><br><span class="line">passwd -S [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#管道命令明文设置密码</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;password&quot;</span> | passwd --stdin [user]</span><br></pre></td></tr></table></figure>

<h3 id="更详细地显示密码参数"><a href="#更详细地显示密码参数" class="headerlink" title="更详细地显示密码参数"></a>更详细地显示密码参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示详细参数</span></span><br><span class="line">chage -l [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#最近一次修改密码日期设置</span></span><br><span class="line">chage -d [YYYY-MM-DD] [user]  <span class="comment"># 若YYYY-MM-DD=0则表示用户下一次登录必须重新设置过密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用户失效日期设置</span></span><br><span class="line">chage -E [YYYY-MM-DD] [user]  <span class="comment"># shadow第8个字段，无法登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#密码过期设置</span></span><br><span class="line">chage -I [YYYY-MM-DD] [user]  <span class="comment"># shadow第7个字段，无法使用此密码登录</span></span><br></pre></td></tr></table></figure>

<h2 id="修改账号信息"><a href="#修改账号信息" class="headerlink" title="修改账号信息"></a>修改账号信息</h2><p>方式1：通过&#x2F;etc&#x2F;passwd和&#x2F;etc&#x2F;group修改</p>
<p>方式2：通过usermod命令修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usermod -L/-U [user] <span class="comment"># 同passwd -l/-u</span></span><br><span class="line">usermod [选项] [user] <span class="comment"># 同useradd选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使账号失效</span></span><br><span class="line">usermod -e 0 [user]</span><br></pre></td></tr></table></figure>

<h2 id="删除账号"><a href="#删除账号" class="headerlink" title="删除账号"></a>删除账号</h2><p>用户的相关数据都会在账号被删除的时候清除，相关数据有：</p>
<ol>
<li>用户账号、密码数据：&#x2F;etc&#x2F;passwd，&#x2F;etc&#x2F;shadow</li>
<li>群组数据：&#x2F;etc&#x2F;group，&#x2F;etc&#x2F;gshadow</li>
<li>个人文件数据：&#x2F;home&#x2F;username，&#x2F;var&#x2F;spool&#x2F;mail&#x2F;username…</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通删除账号</span></span><br><span class="line">userdel [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除账号，连同家目录-r</span></span><br><span class="line">userdel -r username</span><br></pre></td></tr></table></figure>

<h2 id="用户功能"><a href="#用户功能" class="headerlink" title="用户功能"></a>用户功能</h2><ol>
<li>查看id（UID&#x2F;GID）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> [user]</span><br></pre></td></tr></table></figure>

<h2 id="增删改群组"><a href="#增删改群组" class="headerlink" title="增删改群组"></a>增删改群组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通增加群组</span></span><br><span class="line">groupadd [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加的同时指定GID</span></span><br><span class="line">groupadd -g [GID] [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改GID</span></span><br><span class="line">groupmod -g [GID] [group] <span class="comment"># 此命令少用，容易造成系统资源错乱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改群组名字</span></span><br><span class="line">groupmod -n [newName] [oldName]</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除附件群组</span></span><br><span class="line">groupdel [group] <span class="comment"># 删除初始群组通常需要先删除用户，或者更改其GID再删除</span></span><br></pre></td></tr></table></figure>

<h3 id="成员管理"><a href="#成员管理" class="headerlink" title="成员管理"></a>成员管理</h3><ol>
<li>gpasswd</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给群组设置密码(root)</span></span><br><span class="line">gpasswd [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#给群组设置管理员(root)</span></span><br><span class="line">gpasswd -A [user] [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#新增成员(root)</span></span><br><span class="line">gpasswd -M [user] [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除密码/使密码失效(root)</span></span><br><span class="line">gpasswd -r/-R [group]</span><br><span class="line"></span><br><span class="line"><span class="comment">#新增/移除成员（Group Admin、root）</span></span><br><span class="line">gpasswd -a/-d [user] [group]</span><br></pre></td></tr></table></figure>

<h3 id="改变文件所属组"><a href="#改变文件所属组" class="headerlink" title="改变文件所属组"></a>改变文件所属组</h3><ol>
<li>chgrp</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通更改</span></span><br><span class="line"><span class="built_in">chgrp</span> [group] [file] <span class="comment">#group需要在/etc/group中存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归更改子目录但不包括符号链接</span></span><br><span class="line"><span class="built_in">chgrp</span> -hR [group] [file]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>chown</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更改属主和属组</span></span><br><span class="line"><span class="built_in">chown</span> [user]:[group] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment">#递归更改属主和属组但不包括符号链接</span></span><br><span class="line"><span class="built_in">chown</span> -hR [user]:[group] [file]</span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>给出了关于账号和群组的增删查改相关的命令。</p>
<p>‍</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/17/Linux-crontab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | zero">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/17/Linux-crontab/" class="post-title-link" itemprop="url">Linux crontab</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-10-17 10:46:25 / 修改时间：14:37:07" itemprop="dateCreated datePublished" datetime="2024-10-17T10:46:25+08:00">2024-10-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>​<code>crontab</code>​ 是一个用于管理用户的定时任务调度工具。它允许用户设置在特定时间自动运行的命令或脚本，常用于定期执行备份、系统监控、数据处理等任务。</p>
<h1 id="atd-–-执行一次性命令的守护进程"><a href="#atd-–-执行一次性命令的守护进程" class="headerlink" title="atd – 执行一次性命令的守护进程"></a>atd – 执行一次性命令的守护进程</h1><p>生活中，我们有太多场景需要使用到闹钟，比如早上 7 点起床，下午 4 点开会，晚上 8 点购物，等等。</p>
<p>在 Linux 系统里，我们同样也有类似的需求。比如我们想在凌晨 1 点将文件上传服务器，或者在晚上 10 点确认系统状态，等等。</p>
<p>但我们不可能一直守在电脑前，毕竟我们也需要下班&#x2F;睡觉，还要陪对象（new一个也行）。而且即使在上班期间，如果到点了还需要人工操作，未免效率太低了。</p>
<p>​<code>at</code>​ 命令就是为这个需求而诞生的。使用 <code>at</code>​ 命令，你可以在特定时间自动完成你所设定的任务，也可以实现自动化，非常方便快捷！</p>
<h2 id="at安装"><a href="#at安装" class="headerlink" title="at安装"></a>at安装</h2><p>一般来讲，大部分 Linux 发行版都已经安装了 <code>at</code>​ 命令，不确定的话可以使用 <code>at -V</code>​ 命令查看，如果有版本返回，说明就可以正常使用 <code>at</code>​ 命令。</p>
<p>at -V # 查看版本</p>
<h2 id="atd服务启动"><a href="#atd服务启动" class="headerlink" title="atd服务启动"></a>atd服务启动</h2><p>你可以使用 <code>systemctl</code>​ 命令启用 <code>atd</code>​ 服务并将它们设置为从现在开始自动启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now atd</span><br></pre></td></tr></table></figure>

<h2 id="at命令基本用法"><a href="#at命令基本用法" class="headerlink" title="at命令基本用法"></a>at命令基本用法</h2><ul>
<li><p>语法</p>
<p>at [options] [time]</p>
</li>
<li><p>选项</p>
<p>-f 指定包含具体指令的任务文件</p>
<p>-q 指定新任务的队列名称</p>
<p>-l 显示待执行任务的列表</p>
<p>-d 删除待执行的任务</p>
<p>-m 任务执行完后向用户发送邮件</p>
</li>
<li><p>time：时间格式</p>
<p>HH:MM</p>
<p>HH:MM YYYY-MM-DD 或者 HH:MM MM&#x2F;DD&#x2F;YYYY</p>
<p>HH:MM[am|pm] [month] [date]</p>
<p>HH:MM[am|pm] + number [ minutes | hours | days | weeks | months | years ]</p>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ol>
<li>echo “echo ‘hello’ &gt;&gt; &#x2F;home&#x2F;zyming&#x2F;at-test.txt” | at 3:30 am 10&#x2F;01&#x2F;2024 或者 echo “echo ‘hello’ &gt;&gt; &#x2F;home&#x2F;zyming&#x2F;at-test.txt” | at 3:30 am 2024-10-01</li>
</ol>
<h2 id="使用-at-命令交互性安排任务"><a href="#使用-at-命令交互性安排任务" class="headerlink" title="使用 at 命令交互性安排任务"></a>使用 at 命令交互性安排任务</h2><p>at 11:00 am</p>
<blockquote>
<p>echo “hello” &gt;&gt; &#x2F;home&#x2F;zyming&#x2F;at-test.txt</p>
</blockquote>
<p>ctrl+d退出交互环境</p>
<h2 id="使用-at-命令安排任务"><a href="#使用-at-命令安排任务" class="headerlink" title="使用 at 命令安排任务"></a>使用 at 命令安排任务</h2><p>echo “echo ‘hello again’ &gt;&gt; &#x2F;home&#x2F;zyming&#x2F;at-test.txt” | at now + 1 minutes</p>
<h2 id="查看-at-任务队列"><a href="#查看-at-任务队列" class="headerlink" title="查看 at 任务队列"></a>查看 at 任务队列</h2><p>at -l &lt;&#x3D;&gt; atq</p>
<h3 id="从任务队列中删除任务"><a href="#从任务队列中删除任务" class="headerlink" title="从任务队列中删除任务"></a>从任务队列中删除任务</h3><p>atrm &lt;任务编号&gt;</p>
<h2 id="根据at任务列表选择删除的内容"><a href="#根据at任务列表选择删除的内容" class="headerlink" title="根据at任务列表选择删除的内容"></a>根据at任务列表选择删除的内容</h2><p>atq &amp;&amp; read -p “输入待查看at任务编号：” n &amp;&amp; atrm $n</p>
<h2 id="查看at任务内容"><a href="#查看at任务内容" class="headerlink" title="查看at任务内容"></a>查看at任务内容</h2><p>at -c &lt;任务编号&gt; | tail -n +71 | head -n -2</p>
<p>或者</p>
<h3 id="通过管理员权限查看-var-spool-at中保存的内容"><a href="#通过管理员权限查看-var-spool-at中保存的内容" class="headerlink" title="通过管理员权限查看 &#x2F;var&#x2F;spool&#x2F;at中保存的内容"></a>通过管理员权限查看 &#x2F;var&#x2F;spool&#x2F;at中保存的内容</h3><p>(sudo ls &#x2F;var&#x2F;spool&#x2F;at | awk ‘{print NR “：” 1}’) &amp;&amp; read -p “需要查看第几个at任务：” n &amp;&amp; sudo tail -n+71 &#x2F;var&#x2F;spool&#x2F;at&#x2F;(sudo ls &#x2F;var&#x2F;spool&#x2F;at | head -n $n | tail -n 1)| head -n -2</p>
<h2 id="根据at任务列表选择查看的内容"><a href="#根据at任务列表选择查看的内容" class="headerlink" title="根据at任务列表选择查看的内容"></a>根据at任务列表选择查看的内容</h2><p>atq &amp;&amp; read -p “输入待查看at任务编号：” n &amp;&amp;  (at -c $n | tail -n +71 | head -n -2)</p>
<h1 id="batch-–系统空闲时执行的后台任务"><a href="#batch-–系统空闲时执行的后台任务" class="headerlink" title="batch –系统空闲时执行的后台任务"></a>batch –系统空闲时执行的后台任务</h1><p>batch是利用at来进行指令下达的，它会在cpu的工作负载小于0.8时，马上执行用户下达的工作任务。</p>
<ol>
<li>uptime # 查看当前负载（load average）</li>
<li>bc -lq &lt;&lt;&lt; “scale&#x3D;100000; 4*a(1)” &amp;</li>
<li>bc -lq &lt;&lt;&lt; “scale&#x3D;100000; 4*a(1)” &amp; # 小于0.8，则继续增加负载</li>
<li>uptime # 查看当前负载（load average）</li>
<li>batch &gt; &#x2F;usr&#x2F;bin&#x2F;updatedb</li>
<li>date; atq # 查看此时是否执行（当前时间超过计划时间）</li>
<li>jobs &gt; kill -9 %?</li>
<li>uptime;atq # 查看执行与否</li>
</ol>
<h1 id="crond-–-执行周期性命令的守护进程"><a href="#crond-–-执行周期性命令的守护进程" class="headerlink" title="crond – 执行周期性命令的守护进程"></a>crond – 执行周期性命令的守护进程</h1><h2 id="crontab安装与检查"><a href="#crontab安装与检查" class="headerlink" title="crontab安装与检查"></a>crontab安装与检查</h2><p>sudo yum list crontabs # 检查是否安装</p>
<p>crontab -V # 查看版本</p>
<p>sudo yum install crontab</p>
<h2 id="crontab服务启动与关闭"><a href="#crontab服务启动与关闭" class="headerlink" title="crontab服务启动与关闭"></a>crontab服务启动与关闭</h2><p>systemctl start crond # 启动</p>
<p>systemctl stop crond # 关闭</p>
<p>systemctl enable crond # 开机自启</p>
<h2 id="全局配置文件（crontab每分钟检测一次-etc-crontab和-var-spool-cron）"><a href="#全局配置文件（crontab每分钟检测一次-etc-crontab和-var-spool-cron）" class="headerlink" title="全局配置文件（crontab每分钟检测一次&#x2F;etc&#x2F;crontab和&#x2F;var&#x2F;spool&#x2F;cron）"></a>全局配置文件（crontab每分钟检测一次&#x2F;etc&#x2F;crontab和&#x2F;var&#x2F;spool&#x2F;cron）</h2><p>cron.hourly # 是每个小时执行一次的job</p>
<p>cron.daily # 是每天执行一次的job</p>
<p>cron.monthly # 是每月执行一次的job</p>
<p>cron.d # 是系统自动定期需要做的任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/cron.d/0hourly</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run the hourly jobs</span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line">01 * * * * root run-parts /etc/cron.hourly</span><br></pre></td></tr></table></figure>

<p>crontab # 是设定定时任务执行文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/crontab</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br></pre></td></tr></table></figure>

<p>crontab.deny # 文件用于控制不让哪些用户使用crontab</p>
<h2 id="用户配置文件"><a href="#用户配置文件" class="headerlink" title="用户配置文件"></a>用户配置文件</h2><p>每个用户都有自己的cron配置文件，通过crontab -e就可以编辑。</p>
<p><a target="_blank" rel="noopener" href="https://crontab.guru/">时间配置测试网站</a></p>
<p><img src="/2024/10/17/Linux-crontab/image-20240929101230-geczmu2.png" alt="image-geczmu2"></p>
<p>星号（）：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。<br>逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”<br>中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”<br>正斜线（&#x2F;）：可以用正斜线指定时间的间隔频率，例如“0-23&#x2F;2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如&#x2F;10，如果用在minute字段，表示每十分钟执行一次。</p>
<h2 id="定时任务实例"><a href="#定时任务实例" class="headerlink" title="定时任务实例"></a>定时任务实例</h2><ol>
<li><p>每月每天凌晨3点30分和中午12点30分执行test.sh脚本</p>
<p> 30 3,12 * * * &#x2F;home&#x2F;test.sh</p>
</li>
<li><p>每月每天每隔6小时的每30分钟执行test.sh脚本</p>
<p> &#x2F;30 &#x2F;6 * * * &#x2F;home&#x2F;test.sh</p>
</li>
<li><p>每月每天早上8点到下午18点每隔2小时的每30分钟执行test.sh脚本</p>
<p> &#x2F;30 8-18&#x2F;2 * * * &#x2F;home&#x2F;test.sh</p>
</li>
<li><p>每月每天晚上21点30分执行test.sh脚本</p>
<p> 30 21 * * * &#x2F;home&#x2F;test.sh</p>
</li>
<li><p>每月1号、10号、22号凌晨4点45分执行test.sh脚本</p>
<p> 45 4 1,10,22 * * &#x2F;home&#x2F;test.sh</p>
</li>
</ol>
<p><strong>注意</strong></p>
<p> 某些时候天和星期一起设置会冲突</p>
<h2 id="查询-删除当前用户定时任务"><a href="#查询-删除当前用户定时任务" class="headerlink" title="查询&#x2F;删除当前用户定时任务"></a>查询&#x2F;删除当前用户定时任务</h2><p>crontab -l &#x2F; crontab -r</p>
<h1 id="可唤醒停机期间的工作任务（anacron）"><a href="#可唤醒停机期间的工作任务（anacron）" class="headerlink" title="可唤醒停机期间的工作任务（anacron）"></a>可唤醒停机期间的工作任务（anacron）</h1><ol>
<li><p>目的</p>
<p> anacron不是crontab的替代物，它是一个程序，针对非24小时一直启动linux系统的crontab执行，以及由于特殊原因超过预计时间没被执行的定时任务而提出</p>
</li>
</ol>
<h2 id="anacron与-etc-anacrontab"><a href="#anacron与-etc-anacrontab" class="headerlink" title="anacron与&#x2F;etc&#x2F;anacrontab"></a>anacron与&#x2F;etc&#x2F;anacrontab</h2><p>anacron是一个程序，放到了&#x2F;etc&#x2F;cron.hourly，得以每个小时运行一次。</p>
<h2 id="anacrontab的执行流程（以cron-daily为例）"><a href="#anacrontab的执行流程（以cron-daily为例）" class="headerlink" title="anacrontab的执行流程（以cron.daily为例）"></a>anacrontab的执行流程（以cron.daily为例）</h2><ol>
<li>分析&#x2F;etc&#x2F;anacrontab，得到cron.dailly的执行周期为1天；</li>
<li>由&#x2F;var&#x2F;spool&#x2F;cron.daily得到上次执行anacrontab的时间戳；</li>
<li>若该时间戳与目前时间相差超过了1天，那么准备执行指令；</li>
<li>根据&#x2F;etc&#x2F;anacrontab中设定的delay in minutes和START_HOURS_RANGE&#x3D;3-22，得出指令的运行时间应当是在当天的3:00到22:00之间，每个小时的前五分钟内随机执行，若不在此时间范围以内，则在第二天的3:00开始执行；</li>
<li>执行完 run-parts &#x2F;etc&#x2F;cron.daily，anacrontab整个流程结束。</li>
</ol>
<p>总结：anacrontab每个小时去检测时间戳的差距，可以使得cron.daily中的任务每天执行一次，而由于其执行周期为1小时，因此开机后的1小时左右系统会进行一定的检测工作。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zyming</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  






  





</body>
</html>
